<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Differential Diagnosis Tool</title>
    <meta name="description" content="Interactive medical education tool teaching how environmental exposures and social determinants reshape clinical diagnosis">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        // Icon components
        const ChevronDownIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronRightIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const AlertCircleIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const HomeIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const BriefcaseIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
        );

        const MapPinIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const UserIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const DifferentialDiagnosisTool = () => {
          const [selectedCase, setSelectedCase] = useState(0);
          const [revealedFactors, setRevealedFactors] = useState({});
          const [showExplanation, setShowExplanation] = useState(false);
          const [categoryFilter, setCategoryFilter] = useState('all');

          const iconMap = {
            User: UserIcon,
            Home: HomeIcon,
            Briefcase: BriefcaseIcon,
            MapPin: MapPinIcon
          };

          const cases = [
            {
              id: 1,
              category: "Pulmonary",
              title: "Case 1: Community-Acquired Pneumonia",
              initialPresentation: {
                age: 42,
                sex: "Male",
                chiefComplaint: "Productive cough, fever, and dyspnea x 3 days",
                imaging: "Chest X-ray",
                findings: "Right lower lobe opacity with air bronchograms"
              },
              initialDifferential: [
                { diagnosis: "Community-acquired pneumonia", likelihood: "High", reasoning: "Classic presentation with focal consolidation" },
                { diagnosis: "Aspiration pneumonia", likelihood: "Moderate", reasoning: "Right lower lobe location" },
                { diagnosis: "Pulmonary embolism with infarction", likelihood: "Low", reasoning: "Less common" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "48217 (Southwest Detroit)",
                    occupation: "Auto factory worker (25 years)",
                    insurance: "Medicaid"
                  },
                  impact: "High air pollution area near industrial facilities. Occupational lung exposures from metal grinding and welding."
                },
                homeExposures: {
                  title: "Home Environment",
                  icon: "Home",
                  data: {
                    housing: "Rental apartment built 1960",
                    moldVisible: "Yes, bathroom and bedroom",
                    ventilation: "Poor, windows painted shut"
                  },
                  impact: "Chronic mold exposure and poor ventilation increase respiratory disease risk."
                },
                workExposures: {
                  title: "Occupational Exposures",
                  icon: "Briefcase",
                  data: {
                    job: "Metal grinding and welding",
                    ppe: "Inconsistent mask use",
                    duration: "8-hour shifts, 5 days/week for 25 years"
                  },
                  impact: "Chronic metal dust and welding fume exposure. At risk for pneumoconiosis and hypersensitivity pneumonitis."
                },
                environmentalData: {
                  title: "Environmental Context",
                  icon: "MapPin",
                  data: {
                    outbreak: "Recent Legionella outbreak in industrial cooling towers (2 months ago)",
                    proximity: "0.3 miles from steel plant"
                  },
                  impact: "Community Legionella outbreak significantly changes differential. Industrial water systems are common source."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Legionnaires' disease", 
                  likelihood: "Very High", 
                  reasoning: "Community outbreak + occupational exposure to industrial water systems + severe pneumonia. Requires specific antibiotic coverage (fluoroquinolone or azithromycin).",
                  change: "NEW - Critical diagnosis"
                },
                { 
                  diagnosis: "Hypersensitivity pneumonitis (acute)", 
                  likelihood: "Moderate-High", 
                  reasoning: "Chronic mold + metal/welding fumes. May present acutely.",
                  change: "NEW"
                },
                { 
                  diagnosis: "Community-acquired pneumonia", 
                  likelihood: "Moderate", 
                  reasoning: "Still possible but look beyond typical pathogens",
                  change: "REFRAMED"
                }
              ],
              clinicalActions: [
                "Order Legionella urinary antigen test",
                "Adjust antibiotics to cover atypicals",
                "Review prior chest imaging if available",
                "Occupational medicine consult",
                "Consider serum precipitins for HP"
              ],
              teachingPoints: [
                "Always ask about occupational exposures",
                "Zip code reveals air quality and community outbreaks",
                "Recent outbreaks shift your differential",
                "Indoor air quality significantly impacts respiratory health",
                "Standard pneumonia workup misses environmental causes"
              ]
            },

            {
              id: 2,
              category: "Neurological",
              title: "Case 2: Developmental Regression in Child",
              initialPresentation: {
                age: 3,
                sex: "Female",
                chiefComplaint: "Irritability, decreased appetite, developmental regression x 2 months",
                imaging: "Brain MRI",
                findings: "Bilateral symmetric T2 hyperintensities in basal ganglia"
              },
              initialDifferential: [
                { diagnosis: "Hypoxic-ischemic injury", likelihood: "Moderate", reasoning: "Bilateral basal ganglia involvement" },
                { diagnosis: "Metabolic disorder (Leigh syndrome)", likelihood: "Moderate", reasoning: "Progressive symptoms in young child" },
                { diagnosis: "Infectious encephalitis", likelihood: "Low-Moderate", reasoning: "Possible but atypical distribution" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics & Housing",
                  icon: "User",
                  data: {
                    zipCode: "44105 (East Cleveland, OH)",
                    housing: "Rental home built 1925",
                    recentMove: "Moved 3 months ago",
                    siblings: "Two siblings also irritable"
                  },
                  impact: "Pre-1978 housing has extremely high risk for lead paint. Multiple children affected = environmental exposure."
                },
                homeExposures: {
                  title: "Home Environment",
                  icon: "Home",
                  data: {
                    paintCondition: "Peeling and chipping windowsills",
                    renovation: "Landlord painted over peeling areas 1 month ago",
                    observation: "Child seen eating paint chips (pica)"
                  },
                  impact: "CRITICAL: Paint chip ingestion is pathognomonic for lead poisoning. Recent paint disturbance increases exposure."
                },
                workExposures: {
                  title: "Parental Work",
                  icon: "Briefcase",
                  data: {
                    father: "Auto mechanic",
                    takeHome: "Work clothes brought home",
                    handWashing: "Inconsistent before handling children"
                  },
                  impact: "Take-home lead exposure from automotive work is recognized source of childhood lead poisoning."
                },
                environmentalData: {
                  title: "Community",
                  icon: "MapPin",
                  data: {
                    housingStock: "72% built before 1950",
                    soilLead: "Elevated levels documented in neighborhood"
                  },
                  impact: "Documented environmental lead contamination from multiple sources - housing, soil, former industry."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Lead poisoning (chronic)", 
                  likelihood: "Very High", 
                  reasoning: "Pre-1978 housing + peeling paint + renovation + paint chip pica + siblings affected + basal ganglia MRI changes. This IS lead poisoning until proven otherwise.",
                  change: "NEW - URGENT diagnosis requiring reporting"
                },
                { 
                  diagnosis: "Iron deficiency (secondary to lead)", 
                  likelihood: "High", 
                  reasoning: "Often coexists with lead poisoning",
                  change: "NEW"
                },
                { 
                  diagnosis: "Metabolic disorder", 
                  likelihood: "Low", 
                  reasoning: "Environmental context makes this unlikely",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "STAT venous blood lead level",
                "CBC with smear (basophilic stippling)",
                "Test ALL siblings",
                "Mandatory public health reporting",
                "Home lead inspection",
                "Chelation if level >45 mcg/dL",
                "Developmental assessment"
              ],
              teachingPoints: [
                "ALWAYS ask housing age when seeing children with neuro/developmental symptoms",
                "Paint chip pica is highly specific for lead poisoning",
                "Siblings must be screened",
                "Basal ganglia MRI changes in child from old housing = lead poisoning",
                "This is reportable with legal implications for landlords",
                "Environmental justice: disproportionately affects low-income communities"
              ]
            },

            {
              id: 3,
              category: "Neurological",
              title: "Case 3: Chronic Headaches",
              initialPresentation: {
                age: 54,
                sex: "Female",
                chiefComplaint: "Progressive headaches, blurred vision, fatigue x 6 months",
                imaging: "Brain MRI",
                findings: "Diffuse white matter hyperintensities"
              },
              initialDifferential: [
                { diagnosis: "Migraine with aura", likelihood: "Moderate", reasoning: "Age/gender fit" },
                { diagnosis: "Small vessel disease", likelihood: "Moderate", reasoning: "White matter changes" },
                { diagnosis: "Multiple sclerosis", likelihood: "Low-Moderate", reasoning: "White matter lesions" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "63106 (North St. Louis)",
                    housing: "Own home built 1940",
                    occupation: "Elementary school teacher"
                  },
                  impact: "Older urban home with potential infrastructure issues."
                },
                homeExposures: {
                  title: "Home Environment",
                  icon: "Home",
                  data: {
                    heating: "Natural gas furnace and stove",
                    symptomPattern: "Worse in winter, improves away from home",
                    coDetector: "None",
                    familySymptoms: "Husband has similar milder symptoms"
                  },
                  impact: "CRITICAL: Symptoms worse at home + gas appliances + no CO detector + household member affected = carbon monoxide."
                },
                workExposures: {
                  title: "Work Environment",
                  icon: "Briefcase",
                  data: {
                    building: "School built 1955",
                    timePattern: "Improves during breaks and summer",
                    colleagues: "Several report similar symptoms"
                  },
                  impact: "Symptoms improve away from work AND home suggests dual environmental exposures."
                },
                environmentalData: {
                  title: "Community",
                  icon: "MapPin",
                  data: {
                    incidents: "Multiple CO poisoning cases in neighborhood (winter)",
                    weather: "Recent severe winter, increased heating"
                  },
                  impact: "Pattern of neighborhood CO poisonings + seasonal correlation strongly suggests toxin."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Chronic carbon monoxide poisoning", 
                  likelihood: "Very High", 
                  reasoning: "Classic triad: worse at home/winter, household member affected, gas appliances without CO detector. White matter MRI changes consistent with chronic CO.",
                  change: "NEW - Life-threatening, immediate intervention needed"
                },
                { 
                  diagnosis: "Sick building syndrome (school)", 
                  likelihood: "Moderate", 
                  reasoning: "May have dual exposures",
                  change: "NEW"
                },
                { 
                  diagnosis: "Migraine", 
                  likelihood: "Low", 
                  reasoning: "Pattern doesn't fit",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "Carboxyhemoglobin level (may be normal if not acutely exposed)",
                "Test household member",
                "Home CO inspection - check all gas appliances",
                "Install CO detectors IMMEDIATELY",
                "School building air quality assessment",
                "Report to gas company and health department",
                "Neuropsychological testing"
              ],
              teachingPoints: [
                "CO poisoning is the 'great mimicker'",
                "ALWAYS ask: 'Are symptoms better or worse in certain locations?'",
                "Household members with similar symptoms is critical clue",
                "Gas appliances + winter + headaches = check for CO",
                "White matter MRI changes can result from chronic CO",
                "CO detectors are lifesaving and should be universal",
                "Many cases misdiagnosed as viral illness or chronic fatigue"
              ]
            },

            {
              id: 4,
              category: "Pediatric",
              title: "Case 4: Foreign Body Ingestion",
              initialPresentation: {
                age: 2,
                sex: "Female",
                chiefComplaint: "Drooling, refusing to eat, fussy x 4 hours",
                imaging: "Chest X-ray",
                findings: "Round metallic foreign body in mid-esophagus, 20mm diameter"
              },
              initialDifferential: [
                { diagnosis: "Coin ingestion", likelihood: "High", reasoning: "Common in toddlers" },
                { diagnosis: "Button battery", likelihood: "Moderate-High", reasoning: "Similar appearance but EMERGENCY" },
                { diagnosis: "Other foreign body", likelihood: "Low", reasoning: "Less common" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Family Situation",
                  icon: "User",
                  data: {
                    zipCode: "19134 (North Philadelphia)",
                    family: "Single mother, 4 children",
                    income: "Below poverty, two jobs",
                    childcare: "10-year-old watches younger kids"
                  },
                  impact: "Economic stress + inadequate supervision increases injury risk. This is structural inequality, not neglect."
                },
                homeExposures: {
                  title: "Home Environment",
                  icon: "Home",
                  data: {
                    devices: "Remotes, hearing aids, scales accessible",
                    safety: "No outlet covers, cabinet locks, gates",
                    batteries: "Loose in drawer, accessible to children",
                    knowledge: "Mother unaware batteries are dangerous"
                  },
                  impact: "CRITICAL: Multiple battery sources accessible. Inadequate childproofing due to economics and knowledge gap."
                },
                workExposures: {
                  title: "Parental Work",
                  icon: "Briefcase",
                  data: {
                    jobs: "Two part-time jobs, unpredictable hours",
                    leave: "No paid sick leave",
                    childcare: "Cannot afford formal care"
                  },
                  impact: "Economic pressure forces inadequate childcare. Poverty creates conditions for preventable injuries."
                },
                environmentalData: {
                  title: "Public Health Context",
                  icon: "MapPin",
                  data: {
                    epidemiology: "3,000 button battery ingestions/year in US, 15+ deaths",
                    prevention: "Preventable with education and product design"
                  },
                  impact: "Information doesn't reach vulnerable families. Social determinants directly impact child safety."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Button battery - EMERGENCY", 
                  likelihood: "Very High", 
                  reasoning: "Round metallic object + symptoms = BUTTON BATTERY until proven otherwise. Liquefaction necrosis starts in 2 HOURS. Halo sign on X-ray confirms. TREAT AS BATTERY even if uncertain.",
                  change: "NEW - LIFE-THREATENING, mortality risk"
                },
                { 
                  diagnosis: "Esophageal injury from battery", 
                  likelihood: "High", 
                  reasoning: "Drooling/refusal to eat = already causing injury",
                  change: "NEW - Major complication risk"
                },
                { 
                  diagnosis: "Coin (if battery ruled out)", 
                  likelihood: "Low", 
                  reasoning: "Less dangerous but must exclude battery first",
                  change: "Lower priority"
                }
              ],
              clinicalActions: [
                "IMMEDIATE X-ray review: halo sign (AP) or step-off (lateral) = battery",
                "STAT ENT/GI consult: remove <2 hours",
                "Prepare emergency endoscopy NOW",
                "Honey 10mL PO q10min if removal delayed (reduces injury)",
                "NPO, IV access, type & cross",
                "Post-removal: hospitalization, serial imaging for perforation/fistula",
                "Follow-up endoscopy at 24h and 1-2 weeks",
                "Social work: home safety, childproofing resources",
                "Provide free safety supplies"
              ],
              teachingPoints: [
                "Button battery in esophagus = EMERGENCY, necrosis in 2 hours",
                "Death can occur AFTER removal - delayed fistulas/bleeding",
                "Halo sign or step-off = battery. If uncertain, TREAT AS BATTERY",
                "20mm lithium (CR2032) most dangerous - in remotes, scales, toys",
                "Social determinants: poverty increases injury risk",
                "NOT neglect - structural failure to support families",
                "Prevention needs product design + education + economic support",
                "Anticipatory guidance at EVERY well-child visit",
                "Physicians must advocate for paid leave, childcare, living wages"
              ]
            },

            {
              id: 5,
              category: "Renal",
              title: "Case 5: Young Adult with CKD",
              initialPresentation: {
                age: 38,
                sex: "Male",
                chiefComplaint: "Fatigue, decreased urine, elevated Cr 4.2",
                imaging: "Renal ultrasound",
                findings: "Bilateral small kidneys (8cm), increased echogenicity"
              },
              initialDifferential: [
                { diagnosis: "Diabetic nephropathy", likelihood: "Moderate", reasoning: "Common CKD cause" },
                { diagnosis: "Hypertensive nephrosclerosis", likelihood: "Moderate", reasoning: "Common but patient young" },
                { diagnosis: "Chronic glomerulonephritis", likelihood: "Low-Moderate", reasoning: "Could cause small kidneys" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    origin: "Born in El Salvador, agricultural region",
                    location: "33010 (Homestead, FL)",
                    occupation: "Sugarcane worker",
                    familyHistory: "Father died of kidney failure age 45"
                  },
                  impact: "Central America + agricultural work + young ESRD = CKD of unknown etiology epidemic. Father's death suggests same condition."
                },
                homeExposures: {
                  title: "Home & Community",
                  icon: "Home",
                  data: {
                    housing: "Employer barracks near fields",
                    water: "Limited clean water, communal jugs",
                    nsaids: "Takes frequently for pain",
                    energyDrinks: "Multiple daily"
                  },
                  impact: "Heat stress + inadequate water + NSAIDs + energy drinks worsen kidney injury. Community pattern = occupational cause."
                },
                workExposures: {
                  title: "Occupational History",
                  icon: "Briefcase",
                  data: {
                    elSalvador: "Sugarcane cutter age 12-33 (21 years)",
                    florida: "Sugarcane harvester 5 years",
                    conditions: "10-12 hour days, extreme heat",
                    hydration: "Inadequate water breaks",
                    symptoms: "Recurring dehydration, heat exhaustion"
                  },
                  impact: "CRITICAL: 26 years sugarcane + extreme heat + chronic dehydration = THE exposure for Mesoamerican nephropathy."
                },
                environmentalData: {
                  title: "Global Context",
                  icon: "MapPin",
                  data: {
                    epidemic: "CKDu epidemic in Central America - leading cause of death",
                    mechanism: "Heat + dehydration → recurrent AKI → chronic disease",
                    demographics: "Male agricultural workers age 20-50"
                  },
                  impact: "PUBLIC HEALTH EMERGENCY. Patient fits epidemic perfectly. This is occupational disease from extreme conditions."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Mesoamerican nephropathy (CKDu)", 
                  likelihood: "Very High", 
                  reasoning: "Young male + El Salvador + 26 years sugarcane + heat/dehydration + no diabetes/hypertension + father died young of kidney disease + coworkers affected. This IS Mesoamerican nephropathy - occupational kidney disease.",
                  change: "NEW - This is THE diagnosis"
                },
                { 
                  diagnosis: "Heat stress nephropathy", 
                  likelihood: "Very High", 
                  reasoning: "Mechanistic component - repeated AKI from heat",
                  change: "NEW - Contributing"
                },
                { 
                  diagnosis: "NSAID nephropathy", 
                  likelihood: "High", 
                  reasoning: "NSAIDs + dehydration worsen injury",
                  change: "NEW - Contributing"
                },
                { 
                  diagnosis: "Diabetic nephropathy", 
                  likelihood: "Very Low", 
                  reasoning: "CKDu patients typically not diabetic",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "Complete metabolic panel, urinalysis (minimal proteinuria expected)",
                "HbA1c (expect normal), glucose",
                "CBC (anemia), bone profile (PTH, Ca, Phos)",
                "IMMEDIATE: Remove from heat - cannot continue sugarcane work",
                "Urgent nephrology referral (Cr 4.2, nearing dialysis)",
                "Stop NSAIDs and energy drinks",
                "Workers' compensation - occupational disease",
                "Screen coworkers from El Salvador",
                "Prepare for dialysis/transplant evaluation"
              ],
              teachingPoints: [
                "CKDu / Mesoamerican nephropathy is EPIDEMIC in Central America",
                "Young male agricultural workers, especially sugarcane",
                "Does NOT fit traditional CKD: no diabetes, no hypertension, minimal proteinuria",
                "Heat stress + dehydration → recurrent AKI → chronic tubulointerstitial disease",
                "Also in Sri Lanka, India, Florida agricultural workers",
                "PREVENTABLE: water breaks, heat protections, avoid NSAIDs",
                "This is OCCUPATIONAL disease - workers' comp applies",
                "WHO/PAHO recognize as major crisis",
                "Screen ALL agricultural workers from endemic regions",
                "Ask occupation in EVERY young CKD patient without diabetes/hypertension"
              ]
            },

            {
              id: 6,
              category: "Pulmonary",
              title: "Case 6: Post-Hurricane Pneumonia (Florida)",
              initialPresentation: {
                age: 45,
                sex: "Female",
                chiefComplaint: "Fever, cough, hemoptysis x 5 days, worsening on antibiotics",
                imaging: "Chest X-ray",
                findings: "Bilateral infiltrates, cavitation right upper lobe"
              },
              initialDifferential: [
                { diagnosis: "Community-acquired pneumonia", likelihood: "High", reasoning: "Fever, cough, infiltrates" },
                { diagnosis: "Tuberculosis", likelihood: "Moderate", reasoning: "Cavitation, hemoptysis" },
                { diagnosis: "Fungal pneumonia", likelihood: "Low-Moderate", reasoning: "Endemic area" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "33030 (Homestead, FL)",
                    occupation: "Home health aide",
                    medicalHistory: "Diabetes type 2 on insulin"
                  },
                  impact: "South Florida + post-hurricane + diabetes (immunocompromised) = very high fungal infection risk."
                },
                homeExposures: {
                  title: "Post-Hurricane Home",
                  icon: "Home",
                  data: {
                    hurricane: "Hurricane Ian 3 weeks ago, 3 feet flooding",
                    mold: "Extensive visible black/green mold",
                    cleanup: "Cleaned herself WITHOUT PPE (couldn't afford professional)",
                    currentState: "Still living there, walls wet, musty odor",
                    timeline: "Symptoms started 2 weeks after cleaning"
                  },
                  impact: "CRITICAL: Massive mold exposure during cleanup without protection. Diabetic + inhaled mold spores = invasive fungal pneumonia risk."
                },
                workExposures: {
                  title: "Work",
                  icon: "Briefcase",
                  data: {
                    patients: "Many homes also flooded, mold at work",
                    ppe: "Only cloth mask, no N95",
                    coworkers: "Also sick with respiratory symptoms"
                  },
                  impact: "Occupational mold exposure compounds personal exposure. Pattern of coworkers sick = common exposure."
                },
                environmentalData: {
                  title: "Public Health",
                  icon: "MapPin",
                  data: {
                    disaster: "Hurricane Ian Cat 4, 30,000+ homes damaged",
                    warning: "Health department mold warnings",
                    spike: "Documented increase in invasive fungal infections post-Ian"
                  },
                  impact: "Post-disaster mold is PUBLIC HEALTH EMERGENCY. Patient timeline and risk factors fit epidemic pattern."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Invasive pulmonary aspergillosis", 
                  likelihood: "Very High", 
                  reasoning: "Diabetic + massive post-hurricane mold cleanup + cavitation + hemoptysis + failed antibiotics. Timing (2-3 weeks post-exposure) and presentation = INVASIVE ASPERGILLOSIS.",
                  change: "NEW - This is THE diagnosis"
                },
                { 
                  diagnosis: "Mucormycosis (invasive)", 
                  likelihood: "Moderate-High", 
                  reasoning: "Diabetics highest risk for Mucor. Post-flood exposure. MEDICAL EMERGENCY.",
                  change: "NEW - Must rule out urgently"
                },
                { 
                  diagnosis: "Mixed bacterial-fungal", 
                  likelihood: "Moderate", 
                  reasoning: "May have superimposed bacterial infection",
                  change: "NEW"
                },
                { 
                  diagnosis: "Bacterial CAP", 
                  likelihood: "Low", 
                  reasoning: "Failed antibiotics. Exposure makes fungal more likely.",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "URGENT: Invasive fungal infections are life-threatening",
                "STAT chest CT: look for halo sign (Aspergillus)",
                "Bronchoscopy with BAL: fungal culture/stain",
                "Serum galactomannan (highly sensitive for Aspergillus)",
                "Beta-D-glucan (broad fungal marker)",
                "IMMEDIATE empiric voriconazole IV - DO NOT WAIT for cultures",
                "Consider adding amphotericin B if concern for Mucor",
                "Infectious disease consult URGENTLY",
                "ICU monitoring",
                "Optimize diabetes control",
                "Move out of moldy home - cannot return until remediated",
                "Report to health department"
              ],
              teachingPoints: [
                "Post-disaster mold = PUBLIC HEALTH EMERGENCY",
                "Hurricane + humidity + warmth = explosive mold growth",
                "Highest risk: diabetes, HIV, transplant, steroids",
                "Fungal infections 1-4 weeks after heavy mold exposure",
                "Aspergillus: cavitation, halo sign, hemoptysis, progressive despite antibiotics",
                "Mucor: rapidly progressive, high mortality, diabetics at highest risk",
                "Cleanup without PPE = massive spore inhalation",
                "N95 REQUIRED for mold cleanup, especially immunocompromised",
                "Professional remediation recommended - DIY is dangerous",
                "Environmental justice: low-income can't afford remediation",
                "HIGH INDEX OF SUSPICION post-disaster in Florida, Gulf Coast"
              ]
            },

            {
              id: 7,
              category: "Neurological",
              title: "Case 7: Acute Encephalitis (Florida)",
              initialPresentation: {
                age: 52,
                sex: "Male",
                chiefComplaint: "Fever, severe headache, confusion x 3 days",
                imaging: "Brain MRI",
                findings: "Temporal lobe inflammation, bilateral, left > right"
              },
              initialDifferential: [
                { diagnosis: "Herpes simplex encephalitis", likelihood: "High", reasoning: "Temporal lobe classic for HSV" },
                { diagnosis: "Autoimmune encephalitis", likelihood: "Moderate", reasoning: "Temporal involvement, behavioral changes" },
                { diagnosis: "Bacterial meningitis", likelihood: "Low-Moderate", reasoning: "Fever, altered mental status" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "34117 (East Naples, FL - near Everglades)",
                    occupation: "Landscaper, wetland restoration",
                    season: "September (late summer)"
                  },
                  impact: "South Florida + late summer + wetland occupation = arboviral (mosquito-borne) encephalitis risk."
                },
                homeExposures: {
                  title: "Home & Recreation",
                  icon: "Home",
                  data: {
                    location: "Backs up to wetlands, no window screens",
                    evenings: "Outside most evenings",
                    mosquitoes: "Heavy bites, never uses repellent",
                    recentTrip: "Everglades kayaking 2 weeks ago, camped overnight, bitten extensively"
                  },
                  impact: "CRITICAL: Massive mosquito exposure 2 weeks before symptoms in endemic region. South Florida wetlands = EEE and WNV habitat."
                },
                workExposures: {
                  title: "Occupational",
                  icon: "Briefcase",
                  data: {
                    job: "Wetland restoration",
                    timing: "Works dawn and dusk (peak mosquito feeding)",
                    clothing: "Shorts and t-shirt, no long sleeves",
                    repellent: "Never uses ('doesn't like smell')",
                    duration: "15 years daily wetland exposure"
                  },
                  impact: "CRITICAL: Occupational mosquito exposure at peak feeding times without protection. High-risk for arboviral disease."
                },
                environmentalData: {
                  title: "Regional Context",
                  icon: "MapPin",
                  data: {
                    endemic: "South Florida endemic for EEE and West Nile",
                    season: "Late summer = peak mosquito season",
                    alert: "State health dept: 3 EEE cases in SW Florida this season",
                    surveillance: "EEE detected in sentinel chickens",
                    timing: "Incubation 4-10 days; patient 10-14 days post-exposure"
                  },
                  impact: "ENDEMIC region. Late summer + local EEE cases + wetland exposure + temporal lobe = arbovirus top diagnosis."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Eastern Equine Encephalitis (EEE)", 
                  likelihood: "Very High", 
                  reasoning: "Endemic region + September + massive mosquito exposure 2 weeks prior + temporal lobe + recent local cases + outdoor wetland work dawn/dusk = EEE. 30% mortality, highest of arboviruses. Temporal lobe can be affected, not just HSV.",
                  change: "NEW - Life-threatening, primary diagnosis"
                },
                { 
                  diagnosis: "West Nile Virus encephalitis", 
                  likelihood: "High", 
                  reasoning: "Also endemic, same exposures, similar presentation",
                  change: "NEW - Alternative arboviral cause"
                },
                { 
                  diagnosis: "St. Louis encephalitis", 
                  likelihood: "Moderate", 
                  reasoning: "Less common but possible",
                  change: "NEW"
                },
                { 
                  diagnosis: "HSV encephalitis", 
                  likelihood: "Low-Moderate", 
                  reasoning: "Must treat empirically but arbovirus more likely",
                  change: "DECREASED but must still cover"
                }
              ],
              clinicalActions: [
                "STAT HSV PCR - treat empirically with IV acyclovir (don't wait for results)",
                "Lumbar puncture: cell count, protein, Gram stain, culture",
                "CSF arboviral serologies: EEE IgM/IgG, WNV IgM/IgG, SLE IgM/IgG",
                "Serum arboviral serologies",
                "MRI with contrast",
                "EEG (PLEDS if HSV, generalized slowing if arbovirus)",
                "IMMEDIATE report to Florida Dept of Health - REPORTABLE",
                "ICU care - EEE can rapidly deteriorate",
                "Monitor: seizures, ICP, cerebral edema",
                "No specific antiviral for arboviruses (supportive only)",
                "Continue acyclovir until HSV ruled out",
                "Family counseling: EEE 30% mortality, survivors often have permanent deficits"
              ],
              teachingPoints: [
                "Florida arboviruses: EEE, WNV, St. Louis (mosquito-borne)",
                "GEOGRAPHY + SEASON critical: late summer/fall Florida = peak arbovirus",
                "Outdoor occupation + wetlands = very high risk",
                "EEE has HIGHEST mortality (30-50%)",
                "Temporal lobe can occur with arboviruses - NOT pathognomonic for HSV",
                "Diagnosis: CSF IgM > serum IgM diagnostic",
                "No antiviral for arboviruses (unlike HSV)",
                "MUST treat HSV empirically until ruled out",
                "Prevention: repellent, protective clothing, avoid dawn/dusk",
                "Arboviruses REPORTABLE - public health surveillance critical",
                "Similar risks: Southeast US, Gulf Coast, Northeast"
              ]
            },

            {
              id: 8,
              category: "Pulmonary",
              title: "Case 8: Pleural Disease",
              initialPresentation: {
                age: 67,
                sex: "Male",
                chiefComplaint: "Progressive dyspnea, chest pain x 6 months",
                imaging: "Chest CT",
                findings: "Bilateral pleural plaques (calcified), moderate right pleural effusion"
              },
              initialDifferential: [
                { diagnosis: "Parapneumonic effusion", likelihood: "Moderate", reasoning: "Effusion present" },
                { diagnosis: "CHF", likelihood: "Moderate", reasoning: "Dyspnea" },
                { diagnosis: "Pleural plaques from old trauma", likelihood: "Low-Moderate", reasoning: "Calcified plaques" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "23602 (Newport News, VA - naval shipyard)",
                    military: "US Navy 1975-1995 (20 years)",
                    postMilitary: "Auto mechanic 15 years"
                  },
                  impact: "Navy pre-asbestos ban = high exposure. Norfolk area has high mesothelioma rates in shipyard workers."
                },
                homeExposures: {
                  title: "Home",
                  icon: "Home",
                  data: {
                    house: "Built 1955, renovated 2005",
                    diy: "Removed floor tiles and ceiling insulation himself",
                    timing: "Symptoms worsened after renovation",
                    knowledge: "Didn't know tiles had asbestos"
                  },
                  impact: "MAJOR exposure from improper asbestos removal. DIY renovation of pre-1980 building releases asbestos."
                },
                workExposures: {
                  title: "Occupational",
                  icon: "Briefcase",
                  data: {
                    navy: "Machinist's mate, engine room, boiler rooms",
                    duration: "20 years (age 18-38)",
                    ppePast: "None for asbestos in 1970s-80s",
                    mechanic: "Brake/clutch work with asbestos 1995-2010"
                  },
                  impact: "TRIPLE exposure: (1) military shipyard, (2) automotive brake/clutch, (3) home renovation. 48 years latency typical."
                },
                environmentalData: {
                  title: "Context",
                  icon: "MapPin",
                  data: {
                    shipyard: "Near Norfolk Naval Shipyard - major asbestos site",
                    latency: "48 years since initial exposure (20-50 typical)",
                    epidemiology: "Geographic clustering of mesothelioma in area"
                  },
                  impact: "Documented high mesothelioma rates in this community."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Malignant mesothelioma", 
                  likelihood: "Very High", 
                  reasoning: "Pleural plaques (asbestos marker) + new effusion = mesothelioma until proven otherwise. Triple asbestos exposure (Navy, auto mechanic, home renovation). 48-year latency fits. URGENT workup needed.",
                  change: "NEW - Work up urgently"
                },
                { 
                  diagnosis: "Asbestos-related pleural disease (benign)", 
                  likelihood: "Moderate", 
                  reasoning: "Possible but new effusion concerning",
                  change: "NEW"
                },
                { 
                  diagnosis: "Lung cancer (asbestos-related)", 
                  likelihood: "Moderate", 
                  reasoning: "Also possible with this exposure",
                  change: "NEW"
                },
                { 
                  diagnosis: "CHF", 
                  likelihood: "Low", 
                  reasoning: "Unilateral effusion doesn't fit",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "URGENT thoracentesis (cytology, chemistry)",
                "If negative cytology → VATS biopsy (need tissue)",
                "Chest CT with contrast",
                "PET scan if confirmed",
                "Thoracic surgery consult",
                "Document ALL asbestos exposures (VA benefits, legal)",
                "VA claim for service-connected disability",
                "Legal referral for asbestos litigation",
                "Screen household (work clothes exposure)",
                "Tumor markers: mesothelin, fibulin-3"
              ],
              teachingPoints: [
                "Pleural plaques = asbestos exposure (investigate source)",
                "Plaques + new effusion = mesothelioma until proven otherwise",
                "Latency 20-50 years - ask ALL past jobs",
                "Navy pre-1990 = high asbestos risk",
                "Multiple exposure routes: occupational, take-home, home renovation",
                "Auto mechanics had brake/clutch asbestos",
                "Home renovations pre-1980 buildings release asbestos",
                "Mesothelioma in non-smokers (smoking not risk factor)",
                "PREVENTABLE disease",
                "VA benefits and legal compensation available"
              ]
            },

            {
              id: 9,
              category: "Pulmonary",
              title: "Case 9: Chronic Interstitial Lung Disease",
              initialPresentation: {
                age: 55,
                sex: "Male",
                chiefComplaint: "Progressive dyspnea, dry cough x 8 months; acute worsening x 1 week",
                imaging: "High-res chest CT",
                findings: "Ground-glass opacities, centrilobular nodules, mosaic attenuation"
              },
              initialDifferential: [
                { diagnosis: "Idiopathic pulmonary fibrosis", likelihood: "Moderate", reasoning: "Chronic symptoms" },
                { diagnosis: "NSIP", likelihood: "Moderate", reasoning: "Interstitial pattern" },
                { diagnosis: "Hypersensitivity pneumonitis", likelihood: "Low", reasoning: "Need exposure history" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "53042 (Rural Wisconsin)",
                    occupation: "Dairy farmer, 35 years",
                    hobbies: "Raises racing pigeons (200+ birds)"
                  },
                  impact: "Farming community with high HP rates. Dual exposures: moldy hay + bird proteins."
                },
                homeExposures: {
                  title: "Home",
                  icon: "Home",
                  data: {
                    housing: "Lives on farm, barn converted to home",
                    mold: "Visible in basement",
                    pigeons: "Loft adjacent to house, cleans weekly",
                    timing: "Symptoms worse 4-6 hours after feeding birds or handling hay",
                    vacation: "Better during vacations away"
                  },
                  impact: "CRITICAL: Symptoms 4-6 hrs post-exposure = classic acute HP. Better away from environment clinches diagnosis."
                },
                workExposures: {
                  title: "Occupational",
                  icon: "Briefcase",
                  data: {
                    farm: "100 dairy cattle, hay production",
                    hay: "Indoor storage, high humidity, moldy hay common",
                    winter: "Worst in winter (feeding stored hay)",
                    ppe: "No respiratory protection"
                  },
                  impact: "Thermophilic actinomycetes from moldy hay = Farmer's Lung. Plus avian proteins from pigeons."
                },
                environmentalData: {
                  title: "Regional",
                  icon: "MapPin",
                  data: {
                    region: "Upper Midwest - high Farmer's Lung prevalence",
                    season: "Cold winters = more barn time, poor ventilation",
                    storage: "Traditional hay lofts promote mold"
                  },
                  impact: "Regional farming practices create perfect mold conditions."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "Chronic HP (Farmer's Lung + Bird Fancier's)", 
                  likelihood: "Very High", 
                  reasoning: "Symptoms 4-6 hrs after exposure (pathognomonic) + better away + moldy hay + pigeons + CT pattern. DUAL antigens: thermophilic actinomycetes + avian proteins. This explains ALL features.",
                  change: "NEW - Pathognomonic pattern"
                },
                { 
                  diagnosis: "Acute exacerbation of chronic HP", 
                  likelihood: "High", 
                  reasoning: "Recent worsening",
                  change: "NEW"
                },
                { 
                  diagnosis: "IPF", 
                  likelihood: "Very Low", 
                  reasoning: "CT pattern wrong, exposure history decisive",
                  change: "DECREASED"
                }
              ],
              clinicalActions: [
                "Serum precipitins: thermophilic actinomycetes, avian antigens",
                "PFTs (restrictive, reduced DLCO expected)",
                "Bronchoscopy with BAL (lymphocytosis, CD4/CD8 <1)",
                "Trial of antigen avoidance (immediate removal)",
                "Corticosteroids for acute exacerbation",
                "Environmental assessment: culture hay samples",
                "Recommend: dry hay storage, ventilation, N95 minimum",
                "Consider rehoming pigeons",
                "May need occupation change if can't remove exposures"
              ],
              teachingPoints: [
                "Timing: symptoms 4-6 hrs after exposure = acute HP",
                "Better away from environment clinches diagnosis",
                "ALWAYS ask: 'Better/worse in locations/after activities?'",
                "Farmer's Lung = thermophilic actinomycetes in moldy hay",
                "Bird Fancier's = avian proteins",
                "Can have MULTIPLE antigens",
                "HP can be acute (hours) or chronic (insidious fibrosis)",
                "Chronic HP mimics IPF but exposure + CT differentiate",
                "AVOIDANCE = treatment (more important than steroids)",
                "Continued exposure → irreversible fibrosis"
              ]
            },

            {
              id: 10,
              category: "Musculoskeletal",
              title: "Case 10: Multiple Stress Fractures",
              initialPresentation: {
                age: 16,
                sex: "Female",
                chiefComplaint: "Bilateral foot and shin pain x 3 months, worsening with running",
                imaging: "Lower extremity MRI",
                findings: "Multiple stress fractures: bilateral metatarsals, tibiae"
              },
              initialDifferential: [
                { diagnosis: "Overtraining syndrome", likelihood: "High", reasoning: "Athlete with stress fractures" },
                { diagnosis: "Vitamin D deficiency", likelihood: "Moderate", reasoning: "Could contribute" },
                { diagnosis: "Early osteoporosis", likelihood: "Low", reasoning: "Unusual at age 16" }
              ],
              contextualFactors: {
                demographics: {
                  title: "Demographics",
                  icon: "User",
                  data: {
                    zipCode: "10451 (South Bronx)",
                    sport: "Cross-country runner, varsity",
                    family: "Low-income, single-parent household",
                    insurance: "Medicaid"
                  },
                  impact: "Food desert area + poverty. Limited access to nutritious food affects athletic performance and bone health."
                },
                homeExposures: {
                  title: "Home & Nutrition",
                  icon: "Home",
                  data: {
                    foodInsecurity: "Often skips meals, family struggles to afford food",
                    diet: "Mostly processed foods, limited fruits/vegetables",
                    neighborhood: "Food desert - no grocery store within 1 mile",
                    weight: "Lost 15 lbs this season ('trying to get faster')"
                  },
                  impact: "CRITICAL: Food insecurity + intentional weight loss = caloric deficit. Combined with intense training = RED-S risk."
                },
                workExposures: {
                  title: "Athletic Environment",
                  icon: "Briefcase",
                  data: {
                    training: "60+ miles/week, year-round",
                    coachPressure: "Coach emphasizes being 'lean for speed'",
                    menstruation: "Amenorrhea x 1.5 years ('thought it was normal for athletes')",
                    teammates: "Several have similar injuries"
                  },
                  impact: "Classic Female Athlete Triad: (1) low energy availability, (2) menstrual dysfunction, (3) low bone density. Coach emphasis on weight dangerous."
                },
                environmentalData: {
                  title: "Community Context",
                  icon: "MapPin",
                  data: {
                    foodDesert: "South Bronx has lowest grocery store density in NYC",
                    schoolLunch: "Only reliable meal for many students",
                    sportsEmphasis: "Athletics seen as path out of poverty"
                  },
                  impact: "Social determinants: food insecurity + pressure to succeed athletically = perfect storm for RED-S."
                }
              },
              revisedDifferential: [
                { 
                  diagnosis: "RED-S (Relative Energy Deficiency in Sport)", 
                  likelihood: "Very High", 
                  reasoning: "Food insecurity + intentional weight loss + amenorrhea 1.5 years + multiple stress fractures + high training volume = RED-S. This is NOT simple overtraining. This is energy deficit (calories < expenditure) causing hormonal, metabolic, and bone consequences. Amenorrhea indicates severe energy deficit.",
                  change: "NEW - This is THE diagnosis"
                },
                { 
                  diagnosis: "Female Athlete Triad", 
                  likelihood: "Very High", 
                  reasoning: "(1) low energy, (2) amenorrhea, (3) stress fractures. Overlaps with RED-S.",
                  change: "NEW - Same spectrum"
                },
                { 
                  diagnosis: "Eating disorder (possible)", 
                  likelihood: "Moderate", 
                  reasoning: "Intentional weight loss + pressure to be lean. Needs screening.",
                  change: "NEW - Must assess"
                },
                { 
                  diagnosis: "Food insecurity", 
                  likelihood: "High", 
                  reasoning: "Not a diagnosis but ROOT CAUSE. Social determinant driving energy deficit.",
                  change: "NEW - Underlying structural issue"
                },
                { 
                  diagnosis: "Simple overtraining", 
                  likelihood: "Low", 
                  reasoning: "This is more complex - energy deficit is key",
                  change: "REFRAMED"
                }
              ],
              clinicalActions: [
                "Complete history: diet, weight changes, menstrual history",
                "Screen for eating disorder (SCOFF questionnaire, psychiatric eval)",
                "Labs: CBC, CMP, ESR, vitamin D, iron studies",
                "Hormones: estradiol, LH, FSH, TSH, prolactin",
                "DEXA scan (bone density - expect low for age)",
                "Assessment by sports medicine physician",
                "Nutrition consult URGENTLY - registered dietitian specializing in athletes",
                "Address food insecurity: connect family with food assistance programs",
                "School social worker: ensure access to school meals",
                "Coach education: weight-based comments are harmful",
                "MANDATORY rest from running until stress fractures heal",
                "Calcium and vitamin D supplementation",
                "May need estrogen replacement if amenorrhea persists",
                "Mental health support",
                "School intervention: modify PE requirements during recovery",
                "Follow-up: ensure return of menses before full sport resumption"
              ],
              teachingPoints: [
                "RED-S (Relative Energy Deficiency in Sport) affects bone, hormones, metabolism, immune, cardiovascular systems",
                "Female Athlete Triad: (1) low energy availability, (2) menstrual dysfunction, (3) low bone density",
                "Amenorrhea in athlete is NEVER normal - it signals serious energy deficit",
                "Social determinants: food insecurity is ROOT CAUSE in this case",
                "Food deserts limit access to nutritious food, affecting health and athletic performance",
                "Coach/trainer emphasis on weight is dangerous - can trigger eating disorders",
                "This is NOT about athlete being 'too dedicated' - this is about inadequate nutrition",
                "Multiple teammates affected suggests systemic team culture problem",
                "Physicians must address: (1) medical (bone health, nutrition), (2) social (food access), (3) systemic (coach education)",
                "Advocacy needed: school meal programs, food assistance, coach education on RED-S",
                "Return to sport only when: stress fractures healed, menses resumed, eating normalized, bone density improving"
              ]
            }
          ];

          const categories = ['all', 'Pulmonary', 'Neurological', 'Pediatric', 'Renal', 'Musculoskeletal'];

          const filteredCases = categoryFilter === 'all' 
            ? cases 
            : cases.filter(c => c.category === categoryFilter);

          const toggleFactor = (caseId, factorKey) => {
            setRevealedFactors(prev => ({
              ...prev,
              [`${caseId}-${factorKey}`]: !prev[`${caseId}-${factorKey}`]
            }));
          };

          const currentCase = cases[selectedCase];
          const allFactorsRevealed = Object.keys(currentCase.contextualFactors).every(
            key => revealedFactors[`${currentCase.id}-${key}`]
          );

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4 md:p-8">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-4 md:p-8 mb-6">
                  <h1 className="text-2xl md:text-3xl font-bold text-indigo-900 mb-2">
                    Environmental Differential Diagnosis Tool
                  </h1>
                  <p className="text-gray-600 mb-4 text-sm md:text-base">
                    Learn how environmental exposures, demographics, and social determinants reshape clinical reasoning
                  </p>
                  
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                    <div className="flex items-start">
                      <div className="text-blue-500 mt-1 mr-3 flex-shrink-0">
                        <AlertCircleIcon />
                      </div>
                      <div>
                        <p className="text-sm text-gray-700">
                          <strong>Learning Objective:</strong> Traditional imaging reports provide limited context. 
                          This tool demonstrates how environmental and social data can significantly change 
                          your differential diagnosis and clinical management.
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="mb-4">
                    <p className="text-sm text-gray-600 mb-2">Filter by category:</p>
                    <div className="flex flex-wrap gap-2">
                      {categories.map(cat => (
                        <button
                          key={cat}
                          onClick={() => setCategoryFilter(cat)}
                          className={`px-3 py-1 rounded text-sm ${
                            categoryFilter === cat
                              ? 'bg-indigo-600 text-white'
                              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                          }`}
                        >
                          {cat === 'all' ? 'All' : cat}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="flex flex-wrap gap-2 mb-6">
                    {filteredCases.map((c, idx) => {
                      const actualIdx = cases.findIndex(case_ => case_.id === c.id);
                      return (
                        <button
                          key={c.id}
                          onClick={() => {
                            setSelectedCase(actualIdx);
                            setShowExplanation(false);
                            setRevealedFactors({});
                          }}
                          className={`px-3 md:px-4 py-2 rounded-lg transition-colors text-sm md:text-base ${
                            selectedCase === actualIdx
                              ? 'bg-indigo-600 text-white'
                              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                          }`}
                        >
                          Case {c.id}
                        </button>
                      );
                    })}
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                  <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
                    <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-4">
                      Initial Presentation
                    </h2>
                    
                    <div className="space-y-3 mb-6">
                      <div className="bg-gray-50 p-3 md:p-4 rounded">
                        <p className="text-sm font-semibold text-gray-600">Patient:</p>
                        <p className="text-sm md:text-base text-gray-800">
                          {currentCase.initialPresentation.age} year old {currentCase.initialPresentation.sex}
                        </p>
                        <p className="text-sm md:text-base text-gray-800 mt-1">{currentCase.initialPresentation.chiefComplaint}</p>
                      </div>

                      <div className="bg-gray-50 p-3 md:p-4 rounded">
                        <p className="text-sm font-semibold text-gray-600">Imaging:</p>
                        <p className="text-sm md:text-base text-gray-800">{currentCase.initialPresentation.imaging}</p>
                      </div>

                      <div className="bg-yellow-50 p-3 md:p-4 rounded border border-yellow-200">
                        <p className="text-sm font-semibold text-gray-600">Findings:</p>
                        <p className="text-sm md:text-base text-gray-800">{currentCase.initialPresentation.findings}</p>
                      </div>
                    </div>

                    <h3 className="text-base md:text-lg font-semibold text-gray-800 mb-3">
                      Initial Differential
                    </h3>
                    <div className="space-y-3">
                      {currentCase.initialDifferential.map((dx, idx) => (
                        <div key={idx} className="bg-indigo-50 p-3 md:p-4 rounded border border-indigo-200">
                          <div className="flex justify-between items-start mb-2">
                            <p className="font-semibold text-sm md:text-base text-gray-800">{dx.diagnosis}</p>
                            <span className={`text-xs px-2 py-1 rounded flex-shrink-0 ml-2 ${
                              dx.likelihood === 'High' ? 'bg-red-200 text-red-800' :
                              dx.likelihood.includes('Moderate') ? 'bg-yellow-200 text-yellow-800' :
                              'bg-green-200 text-green-800'
                            }`}>
                              {dx.likelihood}
                            </span>
                          </div>
                          <p className="text-xs md:text-sm text-gray-600">{dx.reasoning}</p>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
                    <h2 className="text-lg md:text-xl font-bold text-gray-800 mb-4">
                      Additional Context
                    </h2>
                    <p className="text-xs md:text-sm text-gray-600 mb-4">
                      Click each section to reveal factors that might change your thinking:
                    </p>

                    <div className="space-y-3">
                      {Object.entries(currentCase.contextualFactors).map(([key, factor]) => {
                        const isRevealed = revealedFactors[`${currentCase.id}-${key}`];
                        const IconComponent = iconMap[factor.icon];
                        
                        return (
                          <div key={key} className="border border-gray-200 rounded-lg overflow-hidden">
                            <button
                              onClick={() => toggleFactor(currentCase.id, key)}
                              className="w-full p-3 md:p-4 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors"
                            >
                              <div className="flex items-center gap-2 md:gap-3">
                                <div className="text-indigo-600">
                                  <IconComponent />
                                </div>
                                <span className="font-semibold text-sm md:text-base text-gray-800">{factor.title}</span>
                              </div>
                              {isRevealed ? <ChevronDownIcon /> : <ChevronRightIcon />}
                            </button>
                            
                            {isRevealed && (
                              <div className="p-3 md:p-4 bg-white">
                                <div className="space-y-2 mb-4">
                                  {Object.entries(factor.data).map(([dataKey, value]) => (
                                    <div key={dataKey} className="flex flex-col md:flex-row">
                                      <span className="text-xs md:text-sm font-medium text-gray-600 md:w-32 flex-shrink-0">
                                        {dataKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:
                                      </span>
                                      <span className="text-xs md:text-sm text-gray-800">{value}</span>
                                    </div>
                                  ))}
                                </div>
                                <div className="bg-amber-50 border-l-4 border-amber-500 p-3">
                                  <p className="text-xs md:text-sm font-semibold text-amber-900 mb-1">Impact:</p>
                                  <p className="text-xs md:text-sm text-amber-800">{factor.impact}</p>
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>

                    {allFactorsRevealed && (
                      <button
                        onClick={() => setShowExplanation(true)}
                        className="w-full mt-6 bg-indigo-600 text-white py-2 md:py-3 px-4 md:px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors text-sm md:text-base"
                      >
                        Show Revised Differential
                      </button>
                    )}
                  </div>
                </div>

                {allFactorsRevealed && showExplanation && (
                  <div className="mt-4 md:mt-6 space-y-4 md:space-y-6">
                    <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
                      <h2 className="text-lg md:text-xl font-bold text-green-800 mb-4">
                        Revised Differential
                      </h2>
                      
                      <div className="space-y-3">
                        {currentCase.revisedDifferential.map((dx, idx) => (
                          <div key={idx} className="bg-green-50 p-3 md:p-4 rounded border-2 border-green-300">
                            <div className="flex justify-between items-start mb-2">
                              <p className="font-semibold text-sm md:text-base text-gray-800">{dx.diagnosis}</p>
                              <span className={`text-xs px-2 py-1 rounded flex-shrink-0 ml-2 ${
                                dx.likelihood.includes('Very High') ? 'bg-red-500 text-white' :
                                dx.likelihood.includes('High') ? 'bg-red-200 text-red-800' :
                                dx.likelihood.includes('Moderate') ? 'bg-yellow-200 text-yellow-800' :
                                'bg-green-200 text-green-800'
                              }`}>
                                {dx.likelihood}
                              </span>
                            </div>
                            <p className="text-xs md:text-sm text-gray-700 mb-2">{dx.reasoning}</p>
                            <div className="bg-white p-2 rounded border border-green-200">
                              <p className="text-xs font-semibold text-green-700">
                                {dx.change}
                              </p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-4 md:p-6">
                      <h2 className="text-lg md:text-xl font-bold text-blue-800 mb-4">
                        Clinical Actions
                      </h2>
                      <ul className="space-y-2">
                        {currentCase.clinicalActions.map((action, idx) => (
                          <li key={idx} className="flex items-start text-sm md:text-base">
                            <span className="text-blue-600 mr-2">•</span>
                            <span className="text-gray-700">{action}</span>
                          </li>
                        ))}
                      </ul>
                    </div>

                    <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg shadow-lg p-4 md:p-6 border-2 border-purple-200">
                      <h2 className="text-lg md:text-xl font-bold text-purple-900 mb-4">
                        Key Teaching Points
                      </h2>
                      <ul className="space-y-3">
                        {currentCase.teachingPoints.map((point, idx) => (
                          <li key={idx} className="flex items-start text-sm md:text-base">
                            <span className="text-purple-600 mr-2 font-bold">{idx + 1}.</span>
                            <span className="text-gray-800">{point}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<DifferentialDiagnosisTool />, document.getElementById('root'));
    </script>
</body>
</html>