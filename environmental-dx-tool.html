<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Differential Diagnosis Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide React Icons as inline SVG components
        const ChevronDown = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronRight = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const Home = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const Briefcase = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
        );

        const MapPin = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const User = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const DifferentialDiagnosisTool = () => {
            const [selectedCase, setSelectedCase] = useState(0);
            const [revealedFactors, setRevealedFactors] = useState({});
            const [showExplanation, setShowExplanation] = useState(false);

            const cases = [
                {
                    id: 1,
                    title: "Case 1: Productive Cough and Dyspnea",
                    initialPresentation: {
                        age: 42,
                        sex: "Male",
                        chiefComplaint: "Productive cough, fever, and dyspnea x 3 days",
                        imaging: "Chest X-ray",
                        findings: "Right lower lobe opacity with air bronchograms"
                    },
                    initialDifferential: [
                        { diagnosis: "Community-acquired pneumonia", likelihood: "High", reasoning: "Classic presentation with focal consolidation" },
                        { diagnosis: "Aspiration pneumonia", likelihood: "Moderate", reasoning: "Right lower lobe location common for aspiration" },
                        { diagnosis: "Pulmonary embolism with infarction", likelihood: "Low", reasoning: "Less common, but possible" }
                    ],
                    contextualFactors: {
                        demographics: {
                            title: "Demographics & Social History",
                            icon: User,
                            data: {
                                zipCode: "48217 (Southwest Detroit)",
                                occupation: "Auto factory worker (25 years)",
                                insurance: "Medicaid",
                                housing: "Rental apartment built 1960"
                            },
                            impact: "This zip code has some of the highest air pollution levels in Michigan due to proximity to industrial facilities and major highways."
                        },
                        homeExposures: {
                            title: "Home Environment",
                            icon: Home,
                            data: {
                                heating: "Natural gas furnace (>20 years old)",
                                ventilation: "Poor - windows painted shut",
                                moisture: "Visible mold in bathroom and bedroom",
                                smoking: "Non-smoker, but landlord smokes in building",
                                pets: "None"
                            },
                            impact: "Old gas appliances with poor ventilation can lead to chronic CO and NO2 exposure. Visible mold suggests significant allergen burden."
                        },
                        workExposures: {
                            title: "Occupational Exposures",
                            icon: Briefcase,
                            data: {
                                currentJob: "Metal grinding and welding",
                                ppe: "Inconsistent mask use",
                                exposures: "Metal dust, welding fumes, solvents",
                                ventilation: "Industrial exhaust system present",
                                duration: "8-hour shifts, 5 days/week"
                            },
                            impact: "Chronic inhalational exposure to metal particulates and welding fumes. Workers in this industry have increased risk of pneumoconiosis and hypersensitivity pneumonitis."
                        },
                        environmentalData: {
                            title: "Environmental Factors",
                            icon: MapPin,
                            data: {
                                airQuality: "Poor (AQI often >100)",
                                waterQuality: "Elevated lead levels detected",
                                proximity: "0.3 miles from steel plant, 0.1 miles from I-75",
                                localOutbreaks: "Recent Legionella outbreak in industrial cooling towers (2 months ago)"
                            },
                            impact: "Industrial corridor with multiple pollution sources. Recent Legionella outbreak in area significantly changes differential."
                        }
                    },
                    revisedDifferential: [
                        { 
                            diagnosis: "Legionnaires' disease", 
                            likelihood: "High", 
                            reasoning: "Community outbreak + occupational exposure to industrial water systems + severe pneumonia presentation. Often missed if not considered.",
                            change: "NEW - Critical diagnosis that requires specific antibiotic coverage"
                        },
                        { 
                            diagnosis: "Hypersensitivity pneumonitis (acute)", 
                            likelihood: "Moderate-High", 
                            reasoning: "Chronic mold exposure at home + metal/welding fume exposure at work. May present acutely with pneumonia-like picture.",
                            change: "NEW - Consider if standard pneumonia treatment fails"
                        },
                        { 
                            diagnosis: "Community-acquired pneumonia", 
                            likelihood: "Moderate-High", 
                            reasoning: "Still possible, but environmental factors suggest looking beyond typical pathogens",
                            change: "UNCHANGED but contextualized differently"
                        },
                        { 
                            diagnosis: "Aspiration pneumonia", 
                            likelihood: "Moderate", 
                            reasoning: "Location still fits, but other factors more compelling",
                            change: "UNCHANGED"
                        },
                        { 
                            diagnosis: "Pneumoconiosis with superimposed infection", 
                            likelihood: "Moderate", 
                            reasoning: "25 years of metal dust exposure - may have underlying occupational lung disease",
                            change: "NEW - Long-term consideration for chronic management"
                        }
                    ],
                    clinicalActions: [
                        "Order Legionella urinary antigen test",
                        "Consider respiratory viral panel",
                        "Review prior chest imaging if available",
                        "Consult occupational medicine",
                        "Consider serum precipitins for hypersensitivity pneumonitis",
                        "Adjust antibiotic coverage to include atypicals (Legionella)"
                    ],
                    teachingPoints: [
                        "Always ask about occupational exposures - they're often missed in standard history",
                        "Zip code can tell you about air quality, water quality, and community outbreaks",
                        "Indoor air quality (mold, poor ventilation, gas appliances) significantly impacts respiratory health",
                        "Recent community outbreaks should shift your differential diagnosis",
                        "The 'standard' pneumonia may be anything but standard when you consider the full context"
                    ]
                },
                {
                    id: 2,
                    title: "Case 2: Altered Mental Status in a Child",
                    initialPresentation: {
                        age: 3,
                        sex: "Female",
                        chiefComplaint: "Irritability, decreased appetite, and developmental regression x 2 months",
                        imaging: "Brain MRI",
                        findings: "Bilateral symmetric T2 hyperintensities in basal ganglia"
                    },
                    initialDifferential: [
                        { diagnosis: "Hypoxic-ischemic injury", likelihood: "Moderate", reasoning: "Bilateral basal ganglia involvement" },
                        { diagnosis: "Metabolic disorder (e.g., Leigh syndrome)", likelihood: "Moderate", reasoning: "Progressive neurological symptoms in young child" },
                        { diagnosis: "Infectious encephalitis", likelihood: "Low-Moderate", reasoning: "Possible but less typical distribution" }
                    ],
                    contextualFactors: {
                        demographics: {
                            title: "Demographics & Housing",
                            icon: User,
                            data: {
                                zipCode: "44105 (East Cleveland, OH)",
                                housing: "Rental home built 1925",
                                familyIncome: "Below poverty line",
                                siblings: "Two siblings (ages 5 and 7) - also irritable",
                                recentMove: "Yes - moved to current home 3 months ago"
                            },
                            impact: "Pre-1978 housing in low-income area has extremely high risk for lead paint hazards, especially during renovations or with deteriorating paint."
                        },
                        homeExposures: {
                            title: "Home Environment",
                            icon: Home,
                            data: {
                                paintCondition: "Peeling and chipping on windowsills",
                                renovation: "Landlord 'painted over' peeling areas 1 month ago",
                                waterPipes: "Original plumbing (likely lead)",
                                soil: "Bare soil in yard where children play",
                                cleaning: "Child seen eating paint chips"
                            },
                            impact: "CRITICAL: Multiple lead exposure sources - peeling paint, recent disturbance, old pipes, contaminated soil. Paint chip ingestion is pathognomonic."
                        },
                        workExposures: {
                            title: "Parental Occupations",
                            icon: Briefcase,
                            data: {
                                mother: "Home health aide",
                                father: "Auto mechanic - brings work clothes home",
                                takeHomeExposure: "Potential lead dust on clothing from automotive work",
                                handWashing: "Inconsistent before handling children"
                            },
                            impact: "Take-home lead exposure from automotive work is a recognized source of childhood lead poisoning."
                        },
                        environmentalData: {
                            title: "Community Context",
                            icon: MapPin,
                            data: {
                                housingStock: "72% of homes built before 1950",
                                waterSystem: "City water with lead service lines",
                                soilTesting: "Elevated lead levels documented in neighborhood",
                                localFactories: "Former battery manufacturing plant 2 blocks away"
                            },
                            impact: "This neighborhood has documented environmental lead contamination from multiple sources - industrial legacy, housing stock, and infrastructure."
                        }
                    },
                    revisedDifferential: [
                        { 
                            diagnosis: "Lead poisoning (chronic)", 
                            likelihood: "Very High", 
                            reasoning: "ALL risk factors present: pre-1978 housing, peeling paint, recent renovation, paint chip ingestion (pica), siblings affected, low-income urban area, bilateral basal ganglia changes on MRI. This is lead poisoning until proven otherwise.",
                            change: "NEW - CRITICAL DIAGNOSIS requiring immediate action and reporting"
                        },
                        { 
                            diagnosis: "Metabolic disorder", 
                            likelihood: "Low", 
                            reasoning: "Less likely given environmental context and multiple affected children",
                            change: "DECREASED likelihood"
                        },
                        { 
                            diagnosis: "Hypoxic-ischemic injury", 
                            likelihood: "Very Low", 
                            reasoning: "No history of hypoxic event; environmental exposure much more likely",
                            change: "DECREASED likelihood"
                        },
                        { 
                            diagnosis: "Iron deficiency anemia (secondary to lead)", 
                            likelihood: "High", 
                            reasoning: "Lead poisoning often coexists with iron deficiency; pica may reflect both conditions",
                            change: "NEW - Associated condition"
                        }
                    ],
                    clinicalActions: [
                        "STAT blood lead level (venous sample)",
                        "CBC with peripheral smear (look for basophilic stippling)",
                        "Comprehensive metabolic panel",
                        "Iron studies",
                        "Test ALL siblings for lead exposure",
                        "Mandatory reporting to public health department",
                        "Home inspection for lead hazards",
                        "Developmental assessment and early intervention referral",
                        "Chelation therapy if blood lead level >45 mcg/dL",
                        "Family education about lead hazards and prevention"
                    ],
                    teachingPoints: [
                        "ALWAYS ask about housing age and condition when seeing children with developmental or neurological symptoms",
                        "Paint chip ingestion (pica) is highly specific for lead poisoning",
                        "Lead poisoning can present with vague symptoms that mimic many other conditions",
                        "Siblings and household contacts must be screened",
                        "ZIP code analysis for lead risk should be routine in pediatric care",
                        "MRI findings of bilateral basal ganglia involvement in a young child from old housing = lead poisoning until proven otherwise",
                        "This is a reportable condition with legal implications for landlords",
                        "Environmental justice: lead poisoning disproportionately affects low-income communities and communities of color"
                    ]
                },
                {
                    id: 3,
                    title: "Case 3: Chronic Headaches and Visual Changes",
                    initialPresentation: {
                        age: 54,
                        sex: "Female",
                        chiefComplaint: "Progressive headaches, blurred vision, and fatigue x 6 months",
                        imaging: "Brain MRI with contrast",
                        findings: "Diffuse white matter hyperintensities, no mass or acute infarct"
                    },
                    initialDifferential: [
                        { diagnosis: "Migraine with aura", likelihood: "Moderate", reasoning: "Age and gender fit, but progressive nature concerning" },
                        { diagnosis: "Small vessel disease", likelihood: "Moderate", reasoning: "White matter changes, but extensive for age" },
                        { diagnosis: "Multiple sclerosis", likelihood: "Low-Moderate", reasoning: "White matter lesions, but late age for onset" },
                        { diagnosis: "Chronic daily headache syndrome", likelihood: "Moderate", reasoning: "Chronic pattern" }
                    ],
                    contextualFactors: {
                        demographics: {
                            title: "Demographics & Living Situation",
                            icon: User,
                            data: {
                                zipCode: "63106 (North St. Louis)",
                                housing: "Own home built 1940",
                                occupation: "Elementary school teacher (30 years)",
                                familyHistory: "No significant family history of neurological disease",
                                smokingHistory: "Never smoker"
                            },
                            impact: "Older urban home in area with known infrastructure issues. Long-term stable employment suggests consistent exposure patterns."
                        },
                        homeExposures: {
                            title: "Home Environment",
                            icon: Home,
                            data: {
                                heating: "Natural gas furnace and stove",
                                symptoms: "Worse in winter, improves when away from home",
                                coDetector: "None present",
                                ventilation: "Poor - keeps windows closed in winter",
                                recentAppliances: "Replaced water heater 1 year ago (gas)",
                                familySymptoms: "Husband has similar but milder symptoms"
                            },
                            impact: "CRITICAL: Symptoms worse at home, improved when away + gas appliances + no CO detector + similar symptoms in household member = carbon monoxide poisoning until proven otherwise."
                        },
                        workExposures: {
                            title: "Occupational Environment",
                            icon: Briefcase,
                            data: {
                                building: "Elementary school built 1955, renovated 2010",
                                classroom: "Ground floor with poor ventilation",
                                exposures: "Art supplies, cleaning products",
                                timePattern: "Symptoms improve during school breaks and summer",
                                colleagues: "Several colleagues report similar symptoms"
                            },
                            impact: "Symptoms improving when away from home AND work suggests environmental factors in both locations. School with poor ventilation raises concerns."
                        },
                        environmentalData: {
                            title: "Community & Utilities",
                            icon: MapPin,
                            data: {
                                gasService: "Natural gas provider",
                                incidents: "Multiple CO poisoning cases reported in neighborhood (winter months)",
                                housingAge: "89% of homes built before 1960",
                                weatherPatterns: "Recent severe winter with increased heating use"
                            },
                            impact: "Pattern of neighborhood CO poisonings + seasonal correlation + old housing stock strongly suggests environmental toxin."
                        }
                    },
                    revisedDifferential: [
                        { 
                            diagnosis: "Chronic carbon monoxide poisoning", 
                            likelihood: "Very High", 
                            reasoning: "Classic triad: (1) symptoms worse at home/winter, (2) household member affected, (3) gas appliances without CO detector. White matter changes on MRI are consistent with chronic CO exposure. This explains ALL features.",
                            change: "NEW - Life-threatening diagnosis requiring immediate intervention"
                        },
                        { 
                            diagnosis: "Sick building syndrome (school)", 
                            likelihood: "Moderate", 
                            reasoning: "Symptoms also improve during school breaks; may have dual exposures",
                            change: "NEW - Contributing factor"
                        },
                        { 
                            diagnosis: "Migraine", 
                            likelihood: "Low", 
                            reasoning: "Pattern doesn't fit; environmental triggers more likely",
                            change: "DECREASED likelihood"
                        },
                        { 
                            diagnosis: "Small vessel disease (toxin-induced)", 
                            likelihood: "Moderate", 
                            reasoning: "MRI changes may be from chronic CO exposure rather than primary vascular disease",
                            change: "REFRAMED as secondary to environmental exposure"
                        }
                    ],
                    clinicalActions: [
                        "IMMEDIATE carboxyhemoglobin level (may be normal if not acutely exposed)",
                        "Test household member (husband)",
                        "Home inspection for CO - check all gas appliances and ventilation",
                        "Install CO detectors immediately in home",
                        "Hyperbaric oxygen therapy if indicated",
                        "Neuropsychological testing (CO can cause cognitive impairment)",
                        "School building assessment for air quality",
                        "Report to gas company and local health department",
                        "Consider MRI in 6-12 months to see if white matter changes stabilize after exposure removed"
                    ],
                    teachingPoints: [
                        "CO poisoning is the 'great mimicker' - presents with nonspecific symptoms",
                        "ALWAYS ask: 'Are symptoms better or worse in certain locations?'",
                        "Household members or coworkers with similar symptoms is a critical clue",
                        "Gas appliances + winter months + headaches = check for CO",
                        "White matter changes on MRI can result from chronic CO exposure",
                        "CO detectors are lifesaving and should be universal in homes with gas appliances",
                        "Many CO poisoning cases are misdiagnosed as viral illness, depression, or chronic fatigue",
                        "Environmental exposure can affect both home and workplace simultaneously"
                    ]
                }
            ];

            const toggleFactor = (caseId, factorKey) => {
                setRevealedFactors(prev => ({
                    ...prev,
                    [`${caseId}-${factorKey}`]: !prev[`${caseId}-${factorKey}`]
                }));
            };

            const currentCase = cases[selectedCase];
            const allFactorsRevealed = Object.keys(currentCase.contextualFactors).every(
                key => revealedFactors[`${currentCase.id}-${key}`]
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-8">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                            <h1 className="text-3xl font-bold text-indigo-900 mb-2">
                                Environmental Differential Diagnosis Tool
                            </h1>
                            <p className="text-gray-600 mb-4">
                                Learn how environmental exposures, demographics, and social determinants reshape clinical reasoning
                            </p>
                            
                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                                <div className="flex items-start">
                                    <AlertCircle />
                                    <div className="ml-3">
                                        <p className="text-sm text-gray-700">
                                            <strong>Learning Objective:</strong> Traditional imaging reports provide limited context. 
                                            This tool demonstrates how additional environmental and social data can significantly change 
                                            your differential diagnosis and clinical management.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-2 mb-6">
                                {cases.map((c, idx) => (
                                    <button
                                        key={c.id}
                                        onClick={() => {
                                            setSelectedCase(idx);
                                            setShowExplanation(false);
                                        }}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            selectedCase === idx
                                                ? 'bg-indigo-600 text-white'
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                    >
                                        Case {c.id}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Initial Presentation */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    Initial Presentation (What Radiology Typically Sees)
                                </h2>
                                
                                <div className="space-y-3 mb-6">
                                    <div className="bg-gray-50 p-4 rounded">
                                        <p className="text-sm font-semibold text-gray-600">Reason for Exam:</p>
                                        <p className="text-gray-800">
                                            {currentCase.initialPresentation.age} year old {currentCase.initialPresentation.sex}
                                        </p>
                                        <p className="text-gray-800 mt-1">{currentCase.initialPresentation.chiefComplaint}</p>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded">
                                        <p className="text-sm font-semibold text-gray-600">Imaging Study:</p>
                                        <p className="text-gray-800">{currentCase.initialPresentation.imaging}</p>
                                    </div>

                                    <div className="bg-yellow-50 p-4 rounded border border-yellow-200">
                                        <p className="text-sm font-semibold text-gray-600">Key Findings:</p>
                                        <p className="text-gray-800">{currentCase.initialPresentation.findings}</p>
                                    </div>
                                </div>

                                <h3 className="text-lg font-semibold text-gray-800 mb-3">
                                    Initial Differential Diagnosis
                                </h3>
                                <div className="space-y-3">
                                    {currentCase.initialDifferential.map((dx, idx) => (
                                        <div key={idx} className="bg-indigo-50 p-4 rounded border border-indigo-200">
                                            <div className="flex justify-between items-start mb-2">
                                                <p className="font-semibold text-gray-800">{dx.diagnosis}</p>
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    dx.likelihood === 'High' ? 'bg-red-200 text-red-800' :
                                                    dx.likelihood === 'Moderate' ? 'bg-yellow-200 text-yellow-800' :
                                                    'bg-green-200 text-green-800'
                                                }`}>
                                                    {dx.likelihood}
                                                </span>
                                            </div>
                                            <p className="text-sm text-gray-600">{dx.reasoning}</p>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-6 p-4 bg-gray-100 rounded border-2 border-dashed border-gray-300">
                                    <p className="text-center text-gray-600 italic">
                                        "Correlate clinically" - Traditional radiology sign-off
                                    </p>
                                </div>
                            </div>

                            {/* Contextual Factors */}
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    Additional Contextual Information
                                </h2>
                                <p className="text-sm text-gray-600 mb-4">
                                    Click each section to reveal environmental and social factors that might change your thinking:
                                </p>

                                <div className="space-y-3">
                                    {Object.entries(currentCase.contextualFactors).map(([key, factor]) => {
                                        const isRevealed = revealedFactors[`${currentCase.id}-${key}`];
                                        const Icon = factor.icon;
                                        
                                        return (
                                            <div key={key} className="border border-gray-200 rounded-lg overflow-hidden">
                                                <button
                                                    onClick={() => toggleFactor(currentCase.id, key)}
                                                    className="w-full p-4 flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors"
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <Icon />
                                                        <span className="font-semibold text-gray-800">{factor.title}</span>
                                                    </div>
                                                    {isRevealed ? <ChevronDown /> : <ChevronRight />}
                                                </button>
                                                
                                                {isRevealed && (
                                                    <div className="p-4 bg-white">
                                                        <div className="space-y-2 mb-4">
                                                            {Object.entries(factor.data).map(([dataKey, value]) => (
                                                                <div key={dataKey} className="flex">
                                                                    <span className="text-sm font-medium text-gray-600 w-32 flex-shrink-0">
                                                                        {dataKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:
                                                                    </span>
                                                                    <span className="text-sm text-gray-800">{value}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        <div className="bg-amber-50 border-l-4 border-amber-500 p-3">
                                                            <p className="text-sm font-semibold text-amber-900 mb-1">Clinical Impact:</p>
                                                            <p className="text-sm text-amber-800">{factor.impact}</p>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                {allFactorsRevealed && (
                                    <button
                                        onClick={() => setShowExplanation(true)}
                                        className="w-full mt-6 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                                    >
                                        Show Revised Differential & Clinical Actions
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Revised Differential and Teaching Points */}
                        {allFactorsRevealed && showExplanation && (
                            <div className="mt-6 space-y-6">
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h2 className="text-xl font-bold text-green-800 mb-4">
                                        Revised Differential Diagnosis
                                        <span className="text-sm font-normal text-gray-600 ml-3">
                                            (After Considering Full Context)
                                        </span>
                                    </h2>
                                    
                                    <div className="space-y-3">
                                        {currentCase.revisedDifferential.map((dx, idx) => (
                                            <div key={idx} className="bg-green-50 p-4 rounded border-2 border-green-300">
                                                <div className="flex justify-between items-start mb-2">
                                                    <p className="font-semibold text-gray-800">{dx.diagnosis}</p>
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        dx.likelihood.includes('Very High') ? 'bg-red-500 text-white' :
                                                        dx.likelihood.includes('High') ? 'bg-red-200 text-red-800' :
                                                        dx.likelihood === 'Moderate' || dx.likelihood.includes('Moderate') ? 'bg-yellow-200 text-yellow-800' :
                                                        'bg-green-200 text-green-800'
                                                    }`}>
                                                        {dx.likelihood}
                                                    </span>
                                                </div>
                                                <p className="text-sm text-gray-700 mb-2">{dx.reasoning}</p>
                                                <div className="bg-white p-2 rounded border border-green-200">
                                                    <p className="text-xs font-semibold text-green-700">
                                                        {dx.change}
                                                    </p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <h2 className="text-xl font-bold text-blue-800 mb-4">
                                        Recommended Clinical Actions
                                    </h2>
                                    <ul className="space-y-2">
                                        {currentCase.clinicalActions.map((action, idx) => (
                                            <li key={idx} className="flex items-start">
                                                <span className="text-blue-600 mr-2">â€¢</span>
                                                <span className="text-gray-700">{action}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>

                                <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg shadow-lg p-6 border-2 border-purple-200">
                                    <h2 className="text-xl font-bold text-purple-900 mb-4">
                                        Key Teaching Points
                                    </h2>
                                    <ul className="space-y-3">
                                        {currentCase.teachingPoints.map((point, idx) => (
                                            <li key={idx} className="flex items-start">
                                                <span className="text-purple-600 mr-2 font-bold">{idx + 1}.</span>
                                                <span className="text-gray-800">{point}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        )}

                        {/* Footer Information */}
                        <div className="mt-8 bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-bold text-gray-800 mb-3">How to Use This Tool</h3>
                            <div className="space-y-3 text-gray-700">
                                <p>
                                    <strong>Step 1:</strong> Review the initial presentation and imaging findings - this is what a radiologist typically receives.
                                </p>
                                <p>
                                    <strong>Step 2:</strong> Before revealing the contextual information, formulate your own differential diagnosis.
                                </p>
                                <p>
                                    <strong>Step 3:</strong> Click through each contextual factor. Consider how each piece of information might change your thinking.
                                </p>
                                <p>
                                    <strong>Step 4:</strong> After revealing all factors, click to see the revised differential and compare with your thinking.
                                </p>
                                <p className="text-sm italic text-gray-600 mt-4">
                                    In practice, this information often exists in the EMR but is not integrated with imaging interpretation. 
                                    Imagine a system where radiology reports could automatically incorporate relevant environmental, occupational, 
                                    and demographic data to enhance diagnostic accuracy and clinical correlation.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DifferentialDiagnosisTool />, document.getElementById('root'));
    </script>
</body>
</html>