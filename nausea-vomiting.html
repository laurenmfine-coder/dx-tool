<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Reasoning Tool - Nausea and Vomiting</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        .selected-choice {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
        .excellent-choice {
            background-color: #dcfce7;
            border: 2px solid #16a34a;
        }
        .good-choice {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }
        .fair-choice {
            background-color: #fef3c7;
            border: 2px solid #f59e0b;
        }
        .low-priority-choice {
            background-color: #fee2e2;
            border: 2px solid #dc2626;
        }
        .system-section {
            cursor: pointer;
            transition: all 0.2s;
        }
        .system-section:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const ClinicalReasoningTool = () => {
          const [selectedCase, setSelectedCase] = useState(0);
          const [currentStage, setCurrentStage] = useState('initial');
          const [selectedDifferentials, setSelectedDifferentials] = useState([]);
          const [showDifferentialFeedback, setShowDifferentialFeedback] = useState(false);
          const [selectedHistory, setSelectedHistory] = useState([]);
          const [selectedPhysical, setSelectedPhysical] = useState([]);
          const [showFeedback, setShowFeedback] = useState(false);
          const [showComparison, setShowComparison] = useState(false);
          const [expandedSystems, setExpandedSystems] = useState([]);

          // Helper function for fuzzy matching diagnoses
          const diagnosisMatches = (selected, expected) => {
            const selectedLower = selected.toLowerCase();
            const expectedLower = expected.toLowerCase();
            
            // Exact match
            if (selectedLower === expectedLower) return true;
            
            // Selected contains expected or vice versa
            if (selectedLower.includes(expectedLower) || expectedLower.includes(selectedLower)) return true;
            
            // Check first word match (e.g., "Pregnancy" matches "Early pregnancy/Hyperemesis")
            const selectedFirst = selectedLower.split(/[\s(/]/)[0];
            const expectedFirst = expectedLower.split(/[\s(/]/)[0];
            if (selectedFirst === expectedFirst) return true;
            
            // Common abbreviation handling
            const abbreviations = {
              'dka': 'diabetic ketoacidosis',
              'sbo': 'small bowel obstruction',
              'icp': 'intracranial pressure',
              'mi': 'myocardial infarction'
            };
            
            for (const [abbrev, full] of Object.entries(abbreviations)) {
              if ((selectedLower.includes(abbrev) && expectedLower.includes(full)) ||
                  (selectedLower.includes(full) && expectedLower.includes(abbrev))) {
                return true;
              }
            }
            
            return false;
          };

          const differentialsBySystem = {
            'Gastrointestinal': [
              'Viral gastroenteritis',
              'Gastritis',
              'GERD',
              'Peptic ulcer disease (PUD)',
              'Pancreatitis',
              'Cholecystitis/gallbladder disease',
              'Hepatitis',
              'Small bowel obstruction',
              'Gastroparesis',
              'Food poisoning'
            ],
            'Gynecologic/Reproductive': [
              'Pregnancy/Early pregnancy',
              'Hyperemesis gravidarum',
              'Ectopic pregnancy',
              'Ovarian cyst/rupture',
              'Ovarian torsion',
              'PID',
              'Endometriosis'
            ],
            'Neurological': [
              'Increased intracranial pressure',
              'Migraine',
              'Vestibular disorders',
              'Meningitis',
              'Brain tumor'
            ],
            'Endocrine/Metabolic': [
              'Diabetic ketoacidosis (DKA)',
              'Hyperthyroidism',
              'Hypothyroidism',
              'Adrenal insufficiency',
              'Uremia',
              'Electrolyte disturbance'
            ],
            'Cardiac': [
              'Myocardial infarction (MI)',
              'Heart failure'
            ],
            'Medication/Toxic': [
              'Medication side effect',
              'Drug toxicity',
              'Alcohol-related'
            ],
            'Other': [
              'Anxiety/stress-related',
              'Motion sickness',
              'Cyclic vomiting syndrome'
            ]
          };

          const cases = [
            {
              id: 1,
              title: "Nausea and Vomiting",
              doorNote: {
                name: "Samantha Reyes",
                age: 34,
                sex: "Female",
                location: "Outpatient Urgent Care",
                chiefComplaint: "I've been throwing up for two days and can't keep anything down.",
                vitals: "BP 100/64, Temp 99.1°F, HR 108, RR 18, O₂ Sat 99% RA"
              },
              // NO briefHPI - removed to avoid giving students clues

              expectedDifferential: [
                { 
                  diagnosis: "Early pregnancy/Hyperemesis gravidarum", 
                  priority: "Most likely",
                  reasoning: "Woman of childbearing age + persistent nausea/vomiting + MUST consider pregnancy in any reproductive-age female"
                },
                { 
                  diagnosis: "Viral gastroenteritis", 
                  priority: "Common",
                  reasoning: "Most common cause of acute nausea/vomiting. Need to ask about sick contacts, diarrhea, fever."
                },
                { 
                  diagnosis: "Gastritis", 
                  priority: "Common",
                  reasoning: "Common cause of nausea, especially with NSAID use, alcohol, or stress."
                },
                { 
                  diagnosis: "Small bowel obstruction", 
                  priority: "MUST-NOT-MISS",
                  reasoning: "Surgical emergency. Look for bilious vomiting, distension, no flatus. Tachycardia on vitals is concerning."
                },
                { 
                  diagnosis: "Diabetic ketoacidosis (DKA)", 
                  priority: "MUST-NOT-MISS",
                  reasoning: "Metabolic emergency. Need to ask about diabetes, polyuria, polydipsia, fruity breath odor."
                },
                { 
                  diagnosis: "Increased intracranial pressure", 
                  priority: "MUST-NOT-MISS",
                  reasoning: "Neurologic emergency. Projectile vomiting, headache, vision changes, papilledema on exam."
                },
                { 
                  diagnosis: "Pancreatitis", 
                  priority: "Consider",
                  reasoning: "Ask about alcohol use, gallstones, severe epigastric pain radiating to back."
                }
              ],

              differentialFeedback: {
                mustInclude: ["Pregnancy/Early pregnancy", "Small bowel obstruction", "Diabetic ketoacidosis (DKA)"],
                strongConsider: ["Viral gastroenteritis", "Gastritis", "Increased intracranial pressure"],
                lessLikely: ["Pancreatitis", "Hepatitis"],
                shouldNotInclude: {
                  diagnoses: ["Pneumonia", "Appendicitis", "UTI"],
                  reason: "Not primary presentations for nausea/vomiting"
                }
              },

              historyQuestions: {
                hpiFollowUp: [
                  // ONSET & CHARACTER - Disaggregated
                  {
                    id: "h1",
                    question: "When exactly did the nausea start?",
                    quality: "excellent",
                    rationale: "Timeline is critical. 2 days = acute (infectious, metabolic). Weeks = pregnancy, chronic condition. Onset helps narrow differential significantly.",
                    impactsDx: ["Acute vs chronic causes"]
                  },
                  {
                    id: "h2",
                    question: "How many times per day are you vomiting?",
                    quality: "excellent",
                    rationale: "Frequency indicates severity. 6-7x/day suggests significant fluid loss. Hyperemesis = >3x/day with weight loss/ketonuria.",
                    impactsDx: ["Hyperemesis gravidarum", "Severity assessment"]
                  },
                  {
                    id: "h3",
                    question: "Can you describe what the vomit looks like?",
                    quality: "excellent",
                    rationale: "Content is CRITICAL. Bilious (green/yellow) = distal to ampulla, suggests obstruction. Blood/coffee-grounds = GI bleed. Clear = proximal.",
                    impactsDx: ["SBO - bilious vomiting", "GI bleed - hematemesis"]
                  },
                  {
                    id: "h4",
                    question: "Is the vomit green or yellow colored?",
                    quality: "excellent",
                    rationale: "Bilious vomiting (green/yellow bile) suggests obstruction DISTAL to ampulla of Vater. Red flag for SBO.",
                    impactsDx: ["Small bowel obstruction - key finding"]
                  },
                  {
                    id: "h5",
                    question: "Is there any blood in the vomit?",
                    quality: "excellent",
                    rationale: "Hematemesis = upper GI bleed. Can occur with severe vomiting (Mallory-Weiss tear) or underlying pathology. Changes management.",
                    impactsDx: ["GI bleeding - URGENT if positive"]
                  },
                  {
                    id: "h6",
                    question: "Does the vomit look like coffee grounds?",
                    quality: "excellent",
                    rationale: "Coffee-ground emesis = digested blood from upper GI bleed. Indicates bleeding that has been present long enough to be digested by gastric acid.",
                    impactsDx: ["Upper GI bleed"]
                  },
                  {
                    id: "h7",
                    question: "Is the vomiting projectile?",
                    quality: "excellent",
                    rationale: "Projectile vomiting (forceful, without warning) suggests increased intracranial pressure or gastric outlet obstruction. MUST-NOT-MISS.",
                    impactsDx: ["Increased ICP", "Gastric outlet obstruction"]
                  },

                  // ASSOCIATED GI SYMPTOMS - Disaggregated
                  {
                    id: "h8",
                    question: "Do you have any diarrhea?",
                    quality: "excellent",
                    rationale: "Diarrhea + vomiting = gastroenteritis most likely. ABSENCE of diarrhea makes infectious cause less likely, should consider other causes.",
                    impactsDx: ["Gastroenteritis - diarrhea expected", "Pregnancy - no diarrhea"]
                  },
                  {
                    id: "h9",
                    question: "When was your last bowel movement?",
                    quality: "excellent",
                    rationale: "Obstipation (no stool/gas) = bowel obstruction red flag. Normal bowel function makes SBO much less likely.",
                    impactsDx: ["SBO - obstipation is key finding"]
                  },
                  {
                    id: "h10",
                    question: "Are you passing gas?",
                    quality: "excellent",
                    rationale: "Absence of flatus = complete obstruction. Still passing gas = partial or no obstruction. Critical for SBO evaluation.",
                    impactsDx: ["Complete vs partial SBO"]
                  },
                  {
                    id: "h11",
                    question: "Do you have any abdominal pain?",
                    quality: "excellent",
                    rationale: "Location and character of pain helps differentiate. Crampy = obstruction. Epigastric = gastritis/PUD. RUQ = biliary. Severe = pancreatitis.",
                    impactsDx: ["Multiple GI conditions"]
                  },
                  {
                    id: "h12",
                    question: "Where exactly is the pain located?",
                    quality: "excellent",
                    rationale: "Pain location is diagnostic. Epigastric = gastritis, PUD, pancreatitis. RUQ = biliary. Periumbilical then RLQ = appendicitis. Diffuse = obstruction.",
                    impactsDx: ["Localizes pathology"]
                  },
                  {
                    id: "h13",
                    question: "Is the pain crampy or constant?",
                    quality: "excellent",
                    rationale: "Crampy/colicky = obstruction (waves of peristalsis against obstruction). Constant = inflammation (pancreatitis, cholecystitis).",
                    impactsDx: ["SBO - crampy", "Pancreatitis - constant"]
                  },
                  {
                    id: "h14",
                    question: "Does the pain go to your back?",
                    quality: "excellent",
                    rationale: "Radiation to back = pancreatitis (classic), aortic pathology. Important distinguishing feature.",
                    impactsDx: ["Pancreatitis - back radiation"]
                  },
                  {
                    id: "h15",
                    question: "Is your abdomen swollen or bloated?",
                    quality: "excellent",
                    rationale: "Abdominal distension = key finding for obstruction. Air-fluid levels cause visible distension. Must examine to confirm.",
                    impactsDx: ["SBO - distension expected"]
                  },

                  // PREGNANCY SCREENING - CRITICAL for reproductive age female
                  {
                    id: "h16",
                    question: "When was your last menstrual period?",
                    quality: "excellent",
                    rationale: "CRITICAL in reproductive-age female. Must establish if pregnancy possible. Late/missed period dramatically increases pregnancy probability.",
                    impactsDx: ["Pregnancy - MUST ASK"]
                  },
                  {
                    id: "h17",
                    question: "Are your periods regular?",
                    quality: "excellent",
                    rationale: "Irregular periods can mask early pregnancy. If cycles irregular, LMP less reliable for ruling out pregnancy.",
                    impactsDx: ["Pregnancy risk assessment"]
                  },
                  {
                    id: "h18",
                    question: "Could you be pregnant?",
                    quality: "excellent",
                    rationale: "Direct question. Patients may not volunteer pregnancy concern. Essential in reproductive-age female with nausea.",
                    impactsDx: ["Pregnancy - direct screening"]
                  },
                  {
                    id: "h19",
                    question: "Are you sexually active?",
                    quality: "excellent",
                    rationale: "Establishes pregnancy risk. Even if 'protected,' pregnancy still possible. Necessary to determine if pregnancy test needed.",
                    impactsDx: ["Pregnancy risk"]
                  },
                  {
                    id: "h20",
                    question: "Are you using any birth control?",
                    quality: "excellent",
                    rationale: "No contraception = higher pregnancy risk. Some methods fail. Establishes context for pregnancy probability.",
                    impactsDx: ["Pregnancy risk assessment"]
                  },
                  {
                    id: "h21",
                    question: "Have you taken a pregnancy test?",
                    quality: "excellent",
                    rationale: "Important to know if already tested. Home tests can be false negative early in pregnancy. Still need serum hCG if high suspicion.",
                    impactsDx: ["Pregnancy - testing status"]
                  },

                  // DKA SCREENING - MUST-NOT-MISS
                  {
                    id: "h22",
                    question: "Are you urinating more than usual?",
                    quality: "excellent",
                    rationale: "Polyuria = DKA classic symptom. Osmotic diuresis from hyperglycemia. Combined with nausea/vomiting = high DKA suspicion.",
                    impactsDx: ["DKA - polyuria is classic"]
                  },
                  {
                    id: "h23",
                    question: "Are you very thirsty?",
                    quality: "excellent",
                    rationale: "Polydipsia = DKA symptom. Dehydration from polyuria causes intense thirst. Part of classic DKA triad.",
                    impactsDx: ["DKA - polydipsia classic"]
                  },
                  {
                    id: "h24",
                    question: "Have you lost weight recently without trying?",
                    quality: "excellent",
                    rationale: "Unintentional weight loss in DKA from catabolic state. Also red flag for malignancy. Important to quantify.",
                    impactsDx: ["DKA", "Malignancy red flag"]
                  },

                  // NEUROLOGICAL SCREENING - ICP
                  {
                    id: "h25",
                    question: "Do you have any headaches?",
                    quality: "excellent",
                    rationale: "Headache + vomiting = increased ICP until proven otherwise. MUST ask in vomiting patient. Red flag for CNS pathology.",
                    impactsDx: ["Increased ICP - headache + vomiting = red flag"]
                  },
                  {
                    id: "h26",
                    question: "Is the headache worse in the morning?",
                    quality: "excellent",
                    rationale: "Morning headache = classic ICP sign. ICP rises when supine (overnight). Resolves somewhat with upright position.",
                    impactsDx: ["Increased ICP - morning worse classic"]
                  },
                  {
                    id: "h27",
                    question: "Any vision changes or blurry vision?",
                    quality: "excellent",
                    rationale: "Visual changes with headache/vomiting = increased ICP. Papilledema causes visual symptoms. Neurological emergency.",
                    impactsDx: ["Increased ICP - visual symptoms"]
                  },
                  {
                    id: "h28",
                    question: "Any double vision?",
                    quality: "excellent",
                    rationale: "Diplopia can indicate CN VI palsy from increased ICP. False localizing sign. Important neurological symptom.",
                    impactsDx: ["Increased ICP - CN palsy"]
                  },
                  {
                    id: "h29",
                    question: "Any weakness or numbness?",
                    quality: "good",
                    rationale: "Focal neurological symptoms suggest CNS pathology. Would warrant urgent imaging.",
                    impactsDx: ["CNS pathology"]
                  },

                  // DEHYDRATION ASSESSMENT
                  {
                    id: "h30",
                    question: "Can you keep any fluids down?",
                    quality: "excellent",
                    rationale: "Complete oral intolerance = severe, needs IV fluids. Partial tolerance = may manage outpatient. Key for disposition decision.",
                    impactsDx: ["Severity assessment", "Disposition planning"]
                  },
                  {
                    id: "h31",
                    question: "Are you feeling dizzy or lightheaded?",
                    quality: "excellent",
                    rationale: "Orthostatic symptoms suggest significant volume depletion. Correlated with tachycardia on vitals. May need IV fluids.",
                    impactsDx: ["Dehydration severity"]
                  },
                  {
                    id: "h32",
                    question: "Have you fainted or nearly fainted?",
                    quality: "excellent",
                    rationale: "Syncope/presyncope = severe dehydration or other serious cause (GI bleed, arrhythmia). Changes urgency.",
                    impactsDx: ["Severe dehydration", "Other serious causes"]
                  },

                  // INFECTIOUS SCREENING
                  {
                    id: "h33",
                    question: "Has anyone else around you been sick?",
                    quality: "excellent",
                    rationale: "Sick contacts strongly suggest viral gastroenteritis. Very helpful for narrowing differential if positive.",
                    impactsDx: ["Viral gastroenteritis - sick contacts expected"]
                  },
                  {
                    id: "h34",
                    question: "Have you traveled recently?",
                    quality: "good",
                    rationale: "Travel history for infectious causes - traveler's diarrhea, hepatitis A, parasites. Worth asking briefly.",
                    impactsDx: ["Traveler's diarrhea", "Infectious causes"]
                  },
                  {
                    id: "h35",
                    question: "Have you eaten anything unusual or undercooked?",
                    quality: "good",
                    rationale: "Food poisoning typically has shorter onset (hours). Helps establish timing if recent meal.",
                    impactsDx: ["Food poisoning"]
                  },

                  // LOW-PRIORITY QUESTIONS
                  {
                    id: "h36",
                    question: "On a scale of 1-10, how bad is your nausea?",
                    quality: "low-priority",
                    rationale: "Pain scales have limited utility. Frequency of vomiting and ability to tolerate fluids are more clinically useful metrics.",
                    impactsDx: ["Minimal clinical utility"]
                  },
                  {
                    id: "h37",
                    question: "Have you had nausea before?",
                    quality: "fair",
                    rationale: "History of similar episodes could suggest cyclic vomiting, migraine-associated, or previous hyperemesis. Lower priority than current symptoms.",
                    impactsDx: ["Recurrent causes if relevant"]
                  }
                ],
                
                ros: [
                  // GI ROS - Relevant
                  {
                    id: "r1",
                    question: "Any difficulty swallowing?",
                    quality: "fair",
                    rationale: "Dysphagia suggests esophageal pathology but less relevant in acute nausea/vomiting presentation. Lower priority.",
                    impactsDx: ["Esophageal pathology"]
                  },
                  {
                    id: "r2",
                    question: "Any heartburn or acid reflux?",
                    quality: "good",
                    rationale: "GERD can cause nausea. Helpful for identifying underlying chronic condition contributing to symptoms.",
                    impactsDx: ["GERD", "Gastritis"]
                  },
                  {
                    id: "r3",
                    question: "Any change in appetite?",
                    quality: "fair",
                    rationale: "Most patients with nausea/vomiting will have decreased appetite. Less discriminating than other questions.",
                    impactsDx: ["Nonspecific"]
                  },
                  {
                    id: "r4",
                    question: "Any jaundice or yellowing of skin?",
                    quality: "good",
                    rationale: "Jaundice suggests hepatobiliary pathology. Patient may notice yellow skin/eyes. Better to examine directly.",
                    impactsDx: ["Hepatitis", "Biliary obstruction"]
                  },

                  // NEUROLOGICAL ROS - Important for ICP
                  {
                    id: "r5",
                    question: "Any neck stiffness?",
                    quality: "good",
                    rationale: "Meningismus with headache/vomiting suggests meningitis or SAH. Would warrant urgent workup.",
                    impactsDx: ["Meningitis", "SAH"]
                  },
                  {
                    id: "r6",
                    question: "Any confusion or difficulty thinking?",
                    quality: "good",
                    rationale: "Altered mental status suggests serious cause - metabolic (DKA, uremia), neurological (ICP), severe dehydration.",
                    impactsDx: ["DKA", "Increased ICP", "Severe illness"]
                  },
                  {
                    id: "r7",
                    question: "Any seizures?",
                    quality: "good",
                    rationale: "Seizures with vomiting suggest CNS pathology. Would warrant urgent imaging and evaluation.",
                    impactsDx: ["CNS pathology"]
                  },

                  // CONSTITUTIONAL - Relevant
                  {
                    id: "r8",
                    question: "Any fever or chills?",
                    quality: "good",
                    rationale: "Fever suggests infectious cause or inflammatory process. Temp 99.1 on vitals is low-grade. Ask about higher fevers at home.",
                    impactsDx: ["Infection", "Inflammatory cause"]
                  },
                  {
                    id: "r9",
                    question: "Any night sweats?",
                    quality: "fair",
                    rationale: "Night sweats suggest chronic infection or malignancy. Less relevant in 2-day acute presentation.",
                    impactsDx: ["Chronic illness"]
                  },
                  {
                    id: "r10",
                    question: "How is your energy level?",
                    quality: "fair",
                    rationale: "Fatigue is expected with vomiting and dehydration. Less discriminating for diagnosis.",
                    impactsDx: ["Nonspecific"]
                  },

                  // CARDIAC ROS - Less relevant but consider
                  {
                    id: "r11",
                    question: "Any chest pain?",
                    quality: "fair",
                    rationale: "MI can present with nausea, especially in women. Lower probability in 34-year-old but worth asking briefly.",
                    impactsDx: ["MI - less likely in young woman"]
                  },
                  {
                    id: "r12",
                    question: "Any palpitations?",
                    quality: "fair",
                    rationale: "Tachycardia on vitals likely from dehydration. Subjective palpitations less helpful unless severe.",
                    impactsDx: ["Dehydration effect"]
                  },
                  {
                    id: "r13",
                    question: "Any shortness of breath?",
                    quality: "fair",
                    rationale: "Kussmaul respirations in DKA, but would expect more severe symptoms. Dyspnea could indicate other pathology.",
                    impactsDx: ["DKA", "Other serious illness"]
                  },

                  // PULMONARY ROS - NOT RELEVANT
                  {
                    id: "r14",
                    question: "Any cough?",
                    quality: "low-priority",
                    rationale: "Not related to nausea/vomiting differential. Pulmonary causes don't typically present this way. Skip in focused encounter.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r15",
                    question: "Any wheezing?",
                    quality: "low-priority",
                    rationale: "Not relevant to nausea/vomiting. This is checklist ROS thinking. Stay focused on relevant systems.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r16",
                    question: "Have you coughed up any blood?",
                    quality: "low-priority",
                    rationale: "Hemoptysis unrelated to nausea/vomiting presentation. Skip unless patient volunteers.",
                    impactsDx: ["No impact"]
                  },

                  // GU ROS - NOT RELEVANT (except UTI)
                  {
                    id: "r17",
                    question: "Any burning when you urinate?",
                    quality: "low-priority",
                    rationale: "UTI rarely presents primarily with nausea/vomiting. Unless also has urinary symptoms, skip.",
                    impactsDx: ["Minimal"]
                  },
                  {
                    id: "r18",
                    question: "Any blood in your urine?",
                    quality: "low-priority",
                    rationale: "Hematuria not related to nausea/vomiting differential. Checklist ROS. Focus on relevant questions.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r19",
                    question: "Any flank pain?",
                    quality: "fair",
                    rationale: "Pyelonephritis can cause nausea/vomiting with fever and flank pain. Worth asking if considering UTI/pyelo.",
                    impactsDx: ["Pyelonephritis"]
                  },

                  // MSK ROS - NOT RELEVANT
                  {
                    id: "r20",
                    question: "Any joint pain or swelling?",
                    quality: "low-priority",
                    rationale: "Not related to nausea/vomiting. This is pure checklist ROS. Skip.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r21",
                    question: "Any muscle aches?",
                    quality: "low-priority",
                    rationale: "Myalgias can occur with viral illness but asking specifically adds little value. Skip.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r22",
                    question: "Any back pain?",
                    quality: "fair",
                    rationale: "Already asked about pain radiating to back (pancreatitis). General back pain ROS is lower yield.",
                    impactsDx: ["Already covered in HPI"]
                  },

                  // SKIN ROS - LOW RELEVANCE
                  {
                    id: "r23",
                    question: "Any rashes?",
                    quality: "low-priority",
                    rationale: "Not related to nausea/vomiting differential. Skip in focused encounter.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "r24",
                    question: "Any easy bruising?",
                    quality: "low-priority",
                    rationale: "Could suggest coagulopathy but not relevant to acute nausea/vomiting presentation.",
                    impactsDx: ["No impact"]
                  },

                  // PSYCH ROS - CONSIDER
                  {
                    id: "r25",
                    question: "Are you feeling anxious or stressed?",
                    quality: "fair",
                    rationale: "Anxiety can cause nausea but less likely with severe vomiting. Worth brief exploration if other causes ruled out.",
                    impactsDx: ["Anxiety-related nausea"]
                  },
                  {
                    id: "r26",
                    question: "Any changes in mood?",
                    quality: "low-priority",
                    rationale: "Less relevant to acute nausea/vomiting workup. Mood changes can accompany any illness. Skip.",
                    impactsDx: ["No impact"]
                  },

                  // ENDO ROS
                  {
                    id: "r27",
                    question: "Any tremors or feeling jittery?",
                    quality: "fair",
                    rationale: "Hyperthyroidism can cause nausea with tremor, anxiety, weight loss. Worth considering if other symptoms present.",
                    impactsDx: ["Hyperthyroidism"]
                  },
                  {
                    id: "r28",
                    question: "Any heat or cold intolerance?",
                    quality: "low-priority",
                    rationale: "Thyroid symptoms but not directly relevant to acute vomiting. Lower priority in time-limited encounter.",
                    impactsDx: ["Thyroid disease - lower priority"]
                  }
                ],
                
                pmh: [
                  // DIABETES - CRITICAL for DKA
                  {
                    id: "p1",
                    question: "Do you have diabetes?",
                    quality: "excellent",
                    rationale: "CRITICAL - DKA is must-not-miss diagnosis. Known diabetic with vomiting = high DKA suspicion. Must ask!",
                    impactsDx: ["DKA - diabetes is prerequisite"]
                  },
                  {
                    id: "p2",
                    question: "If you have diabetes, do you take insulin?",
                    quality: "excellent",
                    rationale: "Type 1 diabetics (insulin-dependent) at higher DKA risk. Missed insulin + illness = DKA trigger.",
                    impactsDx: ["DKA risk - insulin-dependent higher risk"]
                  },
                  {
                    id: "p3",
                    question: "Have you missed any insulin doses?",
                    quality: "excellent",
                    rationale: "Missed insulin + nausea/vomiting = very high DKA probability. Common precipitant of DKA.",
                    impactsDx: ["DKA - missed insulin is trigger"]
                  },

                  // GI HISTORY
                  {
                    id: "p4",
                    question: "Have you ever had stomach ulcers?",
                    quality: "good",
                    rationale: "History of PUD suggests recurrence risk. Relevant for gastritis/PUD on differential.",
                    impactsDx: ["PUD recurrence"]
                  },
                  {
                    id: "p5",
                    question: "Have you ever had gallbladder problems?",
                    quality: "good",
                    rationale: "Biliary disease can cause nausea. Previous cholecystitis or gallstones = higher risk biliary cause.",
                    impactsDx: ["Biliary disease"]
                  },
                  {
                    id: "p6",
                    question: "Have you ever had pancreatitis?",
                    quality: "good",
                    rationale: "Recurrent pancreatitis is common. Previous episode makes current pancreatitis more likely.",
                    impactsDx: ["Pancreatitis recurrence"]
                  },
                  {
                    id: "p7",
                    question: "Have you ever had hepatitis?",
                    quality: "fair",
                    rationale: "Viral hepatitis history relevant. Chronic hepatitis could flare. Worth asking briefly.",
                    impactsDx: ["Hepatitis"]
                  },

                  // SURGICAL HISTORY - Important for SBO
                  {
                    id: "p8",
                    question: "Have you ever had abdominal surgery?",
                    quality: "excellent",
                    rationale: "CRITICAL for SBO. Prior abdominal surgery = adhesions = #1 cause of SBO. Must ask!",
                    impactsDx: ["SBO - adhesions from surgery"]
                  },
                  {
                    id: "p9",
                    question: "Have you ever had a hernia?",
                    quality: "good",
                    rationale: "Incarcerated hernia can cause obstruction. Ask about any hernias, especially if had surgery.",
                    impactsDx: ["SBO from incarcerated hernia"]
                  },

                  // NEUROLOGICAL HISTORY
                  {
                    id: "p10",
                    question: "Do you have a history of migraines?",
                    quality: "good",
                    rationale: "Migraine commonly causes nausea/vomiting. Ask about current headache if positive history.",
                    impactsDx: ["Migraine-associated vomiting"]
                  },
                  {
                    id: "p11",
                    question: "Have you ever had any brain or neurological problems?",
                    quality: "fair",
                    rationale: "History of brain tumor, hydrocephalus, or other CNS pathology would increase ICP concern.",
                    impactsDx: ["CNS pathology"]
                  },

                  // PREGNANCY HISTORY
                  {
                    id: "p12",
                    question: "Have you ever been pregnant before?",
                    quality: "good",
                    rationale: "Establishes G/P status. History of hyperemesis in previous pregnancy = higher recurrence risk.",
                    impactsDx: ["Hyperemesis risk"]
                  },
                  {
                    id: "p13",
                    question: "Did you have severe nausea with previous pregnancies?",
                    quality: "excellent",
                    rationale: "Hyperemesis recurs in 15-20% of subsequent pregnancies. Very helpful if positive history.",
                    impactsDx: ["Hyperemesis recurrence"]
                  },

                  // GENERIC PMH
                  {
                    id: "p14",
                    question: "What medical problems do you have?",
                    quality: "fair",
                    rationale: "Good opening but DON'T STOP HERE. Follow with specifics: 'Diabetes? Ulcers? Prior surgeries?' Generic questions need targeted follow-up.",
                    impactsDx: ["Low yield unless followed by specifics"]
                  },
                  {
                    id: "p15",
                    question: "Have you ever been hospitalized?",
                    quality: "fair",
                    rationale: "May reveal relevant history but too broad. Better to ask specific questions about conditions.",
                    impactsDx: ["May reveal relevant history"]
                  },

                  // UNRELATED PMH
                  {
                    id: "p16",
                    question: "Do you have asthma or lung disease?",
                    quality: "low-priority",
                    rationale: "Not related to nausea/vomiting differential. Skip in focused encounter.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "p17",
                    question: "Do you have any heart problems?",
                    quality: "low-priority",
                    rationale: "MI less likely in 34-year-old female without cardiac history. Lower priority unless has risk factors.",
                    impactsDx: ["Low probability in this patient"]
                  },
                  {
                    id: "p18",
                    question: "Do you have high blood pressure?",
                    quality: "low-priority",
                    rationale: "HTN not directly relevant to nausea/vomiting. BP is 100/64 - actually low (dehydration).",
                    impactsDx: ["No impact"]
                  }
                ],
                
                socialHistory: [
                  // ALCOHOL - CRITICAL for pancreatitis/gastritis
                  {
                    id: "s1",
                    question: "How much alcohol do you drink per day?",
                    quality: "excellent",
                    rationale: "Heavy alcohol = #1 cause of pancreatitis. Also causes gastritis. Must quantify daily intake.",
                    impactsDx: ["Alcoholic pancreatitis", "Alcoholic gastritis"]
                  },
                  {
                    id: "s2",
                    question: "How often do you drink alcohol?",
                    quality: "excellent",
                    rationale: "Frequency matters. Daily heavy drinking vs occasional makes big difference for pancreas/liver disease.",
                    impactsDx: ["Pancreatitis", "Hepatitis"]
                  },
                  {
                    id: "s3",
                    question: "Have you been drinking more than usual recently?",
                    quality: "good",
                    rationale: "Binge drinking can trigger pancreatitis. Recent increase in alcohol relevant even without chronic use.",
                    impactsDx: ["Acute pancreatitis"]
                  },

                  // MEDICATIONS - Important
                  {
                    id: "s4",
                    question: "What medications are you taking?",
                    quality: "excellent",
                    rationale: "Many medications cause nausea. Antibiotics, opioids, chemotherapy, metformin. Essential question.",
                    impactsDx: ["Medication-induced nausea"]
                  },
                  {
                    id: "s5",
                    question: "Have you started any new medications recently?",
                    quality: "excellent",
                    rationale: "New medications are common nausea cause. Timing with symptom onset is diagnostic.",
                    impactsDx: ["Medication-induced nausea"]
                  },
                  {
                    id: "s6",
                    question: "Do you take any NSAIDs like ibuprofen or aspirin?",
                    quality: "good",
                    rationale: "NSAIDs cause gastritis. Worth asking specifically as many don't consider OTC as 'medications.'",
                    impactsDx: ["NSAID gastritis"]
                  },
                  {
                    id: "s7",
                    question: "Do you take any vitamins or supplements?",
                    quality: "fair",
                    rationale: "Prenatal vitamins cause nausea (especially iron). Worth asking if pregnancy suspected.",
                    impactsDx: ["Supplement-induced nausea"]
                  },

                  // SUBSTANCE USE
                  {
                    id: "s8",
                    question: "Do you smoke cigarettes?",
                    quality: "fair",
                    rationale: "Smoking worsens GERD and PUD. Less directly relevant to acute vomiting but worth brief inquiry.",
                    impactsDx: ["GERD", "PUD - minor factor"]
                  },
                  {
                    id: "s9",
                    question: "Do you use marijuana?",
                    quality: "good",
                    rationale: "Cannabinoid hyperemesis syndrome causes cyclic vomiting in chronic users. Relieved by hot showers. Important to ask.",
                    impactsDx: ["Cannabinoid hyperemesis syndrome"]
                  },
                  {
                    id: "s10",
                    question: "Do you use any other drugs or substances?",
                    quality: "fair",
                    rationale: "Illicit drugs can cause nausea. Worth asking briefly but often denied.",
                    impactsDx: ["Drug-induced nausea"]
                  },

                  // FAMILY HISTORY
                  {
                    id: "s11",
                    question: "Does anyone in your family have diabetes?",
                    quality: "good",
                    rationale: "Family history of diabetes increases patient's risk. Type 2 can present at any age.",
                    impactsDx: ["DKA - undiagnosed diabetes"]
                  },
                  {
                    id: "s12",
                    question: "Does anyone in your family have stomach or GI problems?",
                    quality: "fair",
                    rationale: "Family history of GI conditions may be relevant but less impactful than patient's own history.",
                    impactsDx: ["Minor factor"]
                  },
                  {
                    id: "s13",
                    question: "Does anyone in your family have thyroid problems?",
                    quality: "fair",
                    rationale: "Thyroid disease runs in families. Worth knowing if considering thyroid cause.",
                    impactsDx: ["Thyroid disease"]
                  },

                  // OCCUPATIONAL/STRESS
                  {
                    id: "s14",
                    question: "What is your occupation?",
                    quality: "fair",
                    rationale: "Occupational exposures rarely cause nausea. Work stress could contribute but low yield question.",
                    impactsDx: ["Minimal"]
                  },
                  {
                    id: "s15",
                    question: "Are you under any unusual stress lately?",
                    quality: "fair",
                    rationale: "Stress can worsen GI symptoms but rarely causes severe vomiting alone. Lower priority.",
                    impactsDx: ["Stress-related GI symptoms"]
                  },

                  // LOW-PRIORITY SOCIAL HISTORY
                  {
                    id: "s16",
                    question: "What is your housing situation?",
                    quality: "low-priority",
                    rationale: "Not relevant to nausea/vomiting differential. Skip in time-limited encounter.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "s17",
                    question: "Who do you live with?",
                    quality: "low-priority",
                    rationale: "Only relevant for sick contacts (already asked). Otherwise not diagnostic.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "s18",
                    question: "What is your annual income?",
                    quality: "low-priority",
                    rationale: "Social determinants matter generally but don't impact acute differential. Skip.",
                    impactsDx: ["No impact"]
                  },
                  {
                    id: "s19",
                    question: "What is your highest level of education?",
                    quality: "low-priority",
                    rationale: "Not relevant to diagnosis. Checklist social history thinking.",
                    impactsDx: ["No impact"]
                  }
                ]
              },

              physicalExam: [
                // VITAL SIGNS ASSESSMENT
                {
                  id: "pe1",
                  maneuver: "Orthostatic blood pressure and heart rate",
                  quality: "excellent",
                  rationale: "CRITICAL for dehydration assessment. Tachycardia (HR 108) already present. Orthostatic drop confirms volume depletion. Changes management.",
                  finding: "BP drops 15 mmHg on standing, HR increases 20 bpm - orthostatic hypotension",
                  impactsDx: "Confirms significant dehydration, supports need for IV fluids"
                },

                // GENERAL APPEARANCE
                {
                  id: "pe2",
                  maneuver: "Assess general appearance and hydration status",
                  quality: "excellent",
                  rationale: "First step in any exam. Ill-appearing vs comfortable? Dehydration signs? Lethargy could indicate serious illness.",
                  finding: "Appears fatigued and mildly dehydrated, not in acute distress",
                  impactsDx: "Moderate illness, not critically ill appearing"
                },
                {
                  id: "pe3",
                  maneuver: "Check mucous membranes for dryness",
                  quality: "excellent",
                  rationale: "Dry mucous membranes = dehydration. Quick, easy assessment of volume status.",
                  finding: "Dry mucous membranes",
                  impactsDx: "Confirms dehydration from vomiting"
                },
                {
                  id: "pe4",
                  maneuver: "Assess skin turgor",
                  quality: "excellent",
                  rationale: "Poor skin turgor (tenting) = dehydration. Best tested on chest or abdomen in adults. Complements mucous membrane exam.",
                  finding: "Poor skin turgor with tenting",
                  impactsDx: "Confirms moderate dehydration"
                },
                {
                  id: "pe5",
                  maneuver: "Check capillary refill",
                  quality: "good",
                  rationale: "Delayed capillary refill (>2 seconds) suggests poor perfusion from dehydration. Quick assessment.",
                  finding: "Capillary refill 2-3 seconds - mildly delayed",
                  impactsDx: "Mild perfusion impairment from volume depletion"
                },

                // ABDOMINAL EXAM - CRITICAL
                {
                  id: "pe6",
                  maneuver: "Abdominal inspection",
                  quality: "good",
                  rationale: "Always start with inspection. Distension = obstruction or ascites. Scars from prior surgery = adhesions risk.",
                  finding: "Abdomen flat, no distension, no surgical scars visible",
                  impactsDx: "Makes SBO less likely (no distension, no surgical history suggested)"
                },
                {
                  id: "pe7",
                  maneuver: "Auscultate abdomen for bowel sounds",
                  quality: "excellent",
                  rationale: "Bowel sounds are KEY. High-pitched/hyperactive = obstruction. Absent = ileus. Normal makes obstruction less likely.",
                  finding: "Bowel sounds present but slightly hypoactive",
                  impactsDx: "Slightly hypoactive - nonspecific, could be early obstruction or just decreased oral intake"
                },
                {
                  id: "pe8",
                  maneuver: "Light palpation of all quadrants",
                  quality: "excellent",
                  rationale: "Start gentle. Identify areas of tenderness before deep palpation. Assess for guarding.",
                  finding: "Mild epigastric tenderness, no guarding",
                  impactsDx: "Epigastric tenderness supports gastritis; no guarding makes peritonitis unlikely"
                },
                {
                  id: "pe9",
                  maneuver: "Deep palpation of epigastric region",
                  quality: "excellent",
                  rationale: "Follow up on tender area. Assess severity of tenderness. Look for masses.",
                  finding: "Moderate tenderness in epigastric area, no masses",
                  impactsDx: "Supports gastritis or other upper GI pathology"
                },
                {
                  id: "pe10",
                  maneuver: "Check for rebound tenderness",
                  quality: "excellent",
                  rationale: "Rebound = peritoneal irritation = peritonitis. Would indicate surgical emergency. MUST test.",
                  finding: "No rebound tenderness",
                  impactsDx: "No peritonitis - rules out perforated viscus, makes surgical emergency less likely"
                },
                {
                  id: "pe11",
                  maneuver: "Check for guarding (voluntary and involuntary)",
                  quality: "excellent",
                  rationale: "Involuntary guarding = peritonitis. Voluntary guarding = patient protecting tender area. Important distinction.",
                  finding: "No involuntary guarding",
                  impactsDx: "No peritonitis"
                },
                {
                  id: "pe12",
                  maneuver: "Murphy's sign (RUQ palpation during inspiration)",
                  quality: "good",
                  rationale: "Positive Murphy's = cholecystitis. Inspiratory arrest during RUQ palpation. Worth checking if considering biliary.",
                  finding: "Murphy's sign negative",
                  impactsDx: "Cholecystitis less likely"
                },
                {
                  id: "pe13",
                  maneuver: "Palpate for hepatomegaly",
                  quality: "fair",
                  rationale: "Enlarged liver could suggest hepatitis or biliary obstruction. Worth checking if considering hepatic cause.",
                  finding: "Liver not palpable below costal margin - normal",
                  impactsDx: "No hepatomegaly"
                },
                {
                  id: "pe14",
                  maneuver: "Percuss abdomen for tympany vs dullness",
                  quality: "fair",
                  rationale: "Tympany throughout = normal gas. Increased tympany could suggest distension. Dullness = fluid or mass.",
                  finding: "Normal tympany throughout",
                  impactsDx: "No evidence of obstruction or ascites"
                },

                // NEUROLOGICAL EXAM - CRITICAL for ICP
                {
                  id: "pe15",
                  maneuver: "Fundoscopic exam for papilledema",
                  quality: "excellent",
                  rationale: "CRITICAL - papilledema = increased ICP. MUST check in vomiting patient, especially with headache. Ophthalmoscope needed.",
                  finding: "No papilledema",
                  impactsDx: "No evidence of increased ICP - makes CNS cause much less likely"
                },
                {
                  id: "pe16",
                  maneuver: "Assess mental status and orientation",
                  quality: "excellent",
                  rationale: "Altered mental status suggests serious cause - DKA, CNS pathology, severe dehydration. Quick but important.",
                  finding: "Alert and oriented x3, appropriate responses",
                  impactsDx: "No encephalopathy, normal mental status reassuring"
                },
                {
                  id: "pe17",
                  maneuver: "Check pupillary response",
                  quality: "good",
                  rationale: "Pupil abnormalities can indicate CNS pathology. PERRLA expected if no neurological cause.",
                  finding: "Pupils equal, round, reactive to light - PERRLA",
                  impactsDx: "No evidence of CN III involvement or ICP"
                },
                {
                  id: "pe18",
                  maneuver: "Assess cranial nerves",
                  quality: "fair",
                  rationale: "Full CN exam lower yield if no neurological symptoms. CN VI palsy can be false localizing sign of ICP.",
                  finding: "Cranial nerves II-XII intact",
                  impactsDx: "No focal neurological deficits"
                },
                {
                  id: "pe19",
                  maneuver: "Check for neck stiffness (meningismus)",
                  quality: "good",
                  rationale: "Neck stiffness + headache + vomiting = meningitis or SAH. Important to check if considering CNS cause.",
                  finding: "Neck supple, no meningismus",
                  impactsDx: "No meningeal signs"
                },

                // DKA ASSESSMENT
                {
                  id: "pe20",
                  maneuver: "Smell breath for fruity/acetone odor",
                  quality: "excellent",
                  rationale: "Fruity/acetone breath = ketones = DKA. Classic finding. Quick and diagnostic if present.",
                  finding: "No fruity odor on breath",
                  impactsDx: "No ketone smell - DKA less likely but doesn't rule out"
                },
                {
                  id: "pe21",
                  maneuver: "Assess respiratory pattern for Kussmaul breathing",
                  quality: "excellent",
                  rationale: "Kussmaul respirations (deep, rapid) = compensation for metabolic acidosis in DKA. Important sign.",
                  finding: "Respiratory pattern normal, RR 18, no Kussmaul breathing",
                  impactsDx: "No evidence of severe metabolic acidosis"
                },

                // CARDIAC EXAM
                {
                  id: "pe22",
                  maneuver: "Auscultate heart sounds",
                  quality: "fair",
                  rationale: "Less critical in young female with nausea but brief cardiac exam is reasonable. Listen for murmurs, extra sounds.",
                  finding: "Tachycardic, regular rhythm, normal S1/S2, no murmurs",
                  impactsDx: "Tachycardia consistent with dehydration, no cardiac pathology"
                },

                // SKIN/JAUNDICE
                {
                  id: "pe23",
                  maneuver: "Check sclerae for icterus (jaundice)",
                  quality: "good",
                  rationale: "Scleral icterus = jaundice = hepatobiliary pathology. Best seen in natural light. Important if considering hepatitis.",
                  finding: "Sclerae white, no icterus",
                  impactsDx: "No jaundice - hepatitis, biliary obstruction less likely"
                },
                {
                  id: "pe24",
                  maneuver: "Check skin for jaundice",
                  quality: "fair",
                  rationale: "Yellow skin confirms jaundice but appears later than scleral icterus. Check if sclerae positive.",
                  finding: "No skin jaundice",
                  impactsDx: "No evidence of hyperbilirubinemia"
                },

                // LOW-PRIORITY EXAMS
                {
                  id: "pe25",
                  maneuver: "Complete lung exam",
                  quality: "low-priority",
                  rationale: "Lung exam not relevant to nausea/vomiting unless respiratory symptoms present. Skip in focused encounter.",
                  finding: "Clear to auscultation bilaterally",
                  impactsDx: "No pulmonary cause"
                },
                {
                  id: "pe26",
                  maneuver: "Check for leg edema",
                  quality: "low-priority",
                  rationale: "Peripheral edema not relevant to acute nausea/vomiting. Would suggest chronic condition (HF, nephrotic).",
                  finding: "No peripheral edema",
                  impactsDx: "No evidence of chronic condition"
                },
                {
                  id: "pe27",
                  maneuver: "Complete neurological exam including strength/sensation",
                  quality: "low-priority",
                  rationale: "Full neuro exam wastes time if no neurological symptoms. Fundoscopic and mental status are key components.",
                  finding: "Strength and sensation intact throughout",
                  impactsDx: "No focal deficits"
                },
                {
                  id: "pe28",
                  maneuver: "CVA tenderness (kidney punch)",
                  quality: "low-priority",
                  rationale: "Pyelonephritis can cause vomiting but patient has no urinary symptoms. Lower priority.",
                  finding: "No CVA tenderness",
                  impactsDx: "No evidence of renal pathology"
                }
              ],

              diagnosticStudies: [
                {
                  study: "Urine pregnancy test (hCG)",
                  priority: "FIRST TEST - MUST ORDER",
                  rationale: "MANDATORY in reproductive-age female. Must rule out pregnancy before any other workup. Quick, cheap, critical.",
                  expectedResult: "POSITIVE",
                  interpretation: "Confirms pregnancy as cause of nausea/vomiting. Now must determine if viable and if hyperemesis."
                },
                {
                  study: "Serum hCG (quantitative)",
                  priority: "Order if urine positive",
                  rationale: "Quantifies hCG level. Helps date pregnancy and follow for viability. Very high levels associated with hyperemesis.",
                  expectedResult: "28,000 mIU/mL (consistent with early pregnancy)",
                  interpretation: "Elevated hCG consistent with early pregnancy. Level appropriate for gestational age."
                },
                {
                  study: "Basic Metabolic Panel (BMP)",
                  priority: "Essential",
                  rationale: "Assesses electrolytes (vomiting causes hypokalemia), glucose (DKA), BUN/Cr (dehydration, renal function).",
                  expectedResult: "K+ 3.2 (low), BUN 22 (elevated), Cr 1.1, Glucose 88",
                  interpretation: "Hypokalemia from vomiting, elevated BUN/Cr ratio = dehydration. Need potassium replacement and IV fluids."
                },
                {
                  study: "Complete Blood Count (CBC)",
                  priority: "Important",
                  rationale: "WBC for infection, H/H for bleeding or hemoconcentration from dehydration.",
                  expectedResult: "WBC 11.2 (mild elevation), Hgb 13.2, Plt 350",
                  interpretation: "Mild leukocytosis (stress response), mild hemoconcentration from dehydration. No anemia."
                },
                {
                  study: "Lipase",
                  priority: "Consider",
                  rationale: "Rules out pancreatitis. Should be ordered if epigastric pain, especially with alcohol history.",
                  expectedResult: "Normal",
                  interpretation: "Normal lipase rules out pancreatitis"
                },
                {
                  study: "Liver function tests (LFTs)",
                  priority: "Consider",
                  rationale: "Rules out hepatitis, biliary obstruction. AST/ALT elevation would suggest hepatic cause.",
                  expectedResult: "Normal",
                  interpretation: "Normal LFTs rule out hepatitis"
                },
                {
                  study: "Pelvic ultrasound",
                  priority: "Order if pregnancy confirmed",
                  rationale: "Confirms intrauterine pregnancy, rules out ectopic, estimates gestational age. Essential after positive hCG.",
                  expectedResult: "Intrauterine pregnancy, no ectopic, no free fluid",
                  interpretation: "Viable intrauterine pregnancy confirmed. No ectopic pregnancy."
                }
              ],

              actualDiagnosis: {
                diagnosis: "Early pregnancy with hyperemesis gravidarum",
                keyFindings: [
                  "34-year-old woman of childbearing age",
                  "Persistent nausea and vomiting x 2 days",
                  "Unable to tolerate oral intake",
                  "Positive pregnancy test",
                  "Tachycardia and orthostatic hypotension indicating dehydration",
                  "Hypokalemia and elevated BUN from vomiting",
                  "Mild epigastric tenderness on exam"
                ],
                reasoning: "This case illustrates the importance of ALWAYS considering pregnancy in reproductive-age females with nausea/vomiting. Hyperemesis gravidarum is severe nausea/vomiting in pregnancy causing dehydration, ketonuria, and weight loss. Vitals show tachycardia and low BP indicating volume depletion. Labs confirm dehydration and electrolyte abnormalities. Treatment requires IV fluids, antiemetics, and potassium replacement.",
                nextSteps: "IV fluid resuscitation, potassium replacement, antiemetics (safe in pregnancy: ondansetron, metoclopramide, or vitamin B6), OB referral, dietary counseling"
              },

              teachingPoints: [
                "CRITICAL: Always consider pregnancy in reproductive-age females with nausea/vomiting",
                "First test in reproductive-age female with vomiting = pregnancy test",
                "Hyperemesis gravidarum: nausea/vomiting + dehydration + ketonuria + weight loss in pregnancy",
                "Must-not-miss: SBO, DKA, increased ICP - all can present with vomiting",
                "Bilious (green/yellow) vomiting = obstruction distal to ampulla of Vater",
                "Projectile vomiting without warning = increased ICP until proven otherwise",
                "Always do fundoscopic exam in vomiting patient - papilledema = ICP",
                "Assess dehydration: mucous membranes, skin turgor, orthostatics, BUN/Cr ratio",
                "Prior abdominal surgery = adhesions = #1 cause of SBO",
                "Cannabinoid hyperemesis syndrome: chronic cannabis users, cyclic vomiting, relieved by hot showers"
              ]
            }
          ];

          const currentCase = cases[selectedCase];

          const toggleDifferentialSelection = (diagnosis) => {
            if (selectedDifferentials.includes(diagnosis)) {
              setSelectedDifferentials(selectedDifferentials.filter(d => d !== diagnosis));
            } else {
              setSelectedDifferentials([...selectedDifferentials, diagnosis]);
            }
          };

          const toggleSystemExpansion = (system) => {
            if (expandedSystems.includes(system)) {
              setExpandedSystems(expandedSystems.filter(s => s !== system));
            } else {
              setExpandedSystems([...expandedSystems, system]);
            }
          };

          const getComparisonData = () => {
            const allQuestions = [
              ...currentCase.historyQuestions.hpiFollowUp,
              ...currentCase.historyQuestions.ros,
              ...currentCase.historyQuestions.pmh,
              ...currentCase.historyQuestions.socialHistory
            ];
            
            const optimalQuestions = allQuestions.filter(q => q.quality === 'excellent' || q.quality === 'good');
            const optimalIds = optimalQuestions.map(q => q.id);
            
            const selectedOptimal = selectedHistory.filter(id => optimalIds.includes(id));
            const missedOptimal = optimalIds.filter(id => !selectedHistory.includes(id));
            const lowPrioritySelected = selectedHistory.filter(id => {
              const q = allQuestions.find(q => q.id === id);
              return q && (q.quality === 'low-priority' || q.quality === 'fair');
            });
            
            return {
              totalSelected: selectedHistory.length,
              totalOptimal: optimalIds.length,
              selectedOptimal: selectedOptimal.length,
              missedOptimal: missedOptimal.length,
              lowPrioritySelected: lowPrioritySelected.length,
              missedOptimalQuestions: allQuestions.filter(q => missedOptimal.includes(q.id)),
              lowPriorityQuestions: allQuestions.filter(q => lowPrioritySelected.includes(q.id)),
              efficiency: Math.round((selectedOptimal.length / Math.max(selectedHistory.length, 1)) * 100)
            };
          };

          const getPhysicalComparisonData = () => {
            const allExams = currentCase.physicalExam;
            const optimalExams = allExams.filter(e => e.quality === 'excellent' || e.quality === 'good');
            const optimalIds = optimalExams.map(e => e.id);
            
            const selectedOptimal = selectedPhysical.filter(id => optimalIds.includes(id));
            const missedOptimal = optimalIds.filter(id => !selectedPhysical.includes(id));
            const lowPrioritySelected = selectedPhysical.filter(id => {
              const e = allExams.find(e => e.id === id);
              return e && (e.quality === 'low-priority' || e.quality === 'fair');
            });
            
            return {
              totalSelected: selectedPhysical.length,
              totalOptimal: optimalIds.length,
              selectedOptimal: selectedOptimal.length,
              missedOptimal: missedOptimal.length,
              lowPrioritySelected: lowPrioritySelected.length,
              missedOptimalExams: allExams.filter(e => missedOptimal.includes(e.id)),
              lowPriorityExams: allExams.filter(e => lowPrioritySelected.includes(e.id)),
              efficiency: Math.round((selectedOptimal.length / Math.max(selectedPhysical.length, 1)) * 100)
            };
          };

          const renderComparisonView = () => {
            const data = getComparisonData();
            
            return (
              <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 className="text-2xl font-bold text-gray-900 mb-4">📊 History Performance Analysis</h3>
                
                <div className="grid grid-cols-2 gap-4 mb-6">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-blue-900">{data.totalSelected}</div>
                    <div className="text-sm text-blue-700">Questions You Selected</div>
                  </div>
                  <div className="bg-green-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-green-900">{data.totalOptimal}</div>
                    <div className="text-sm text-green-700">Optimal High-Yield Questions</div>
                  </div>
                  <div className="bg-emerald-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-emerald-900">{data.selectedOptimal}</div>
                    <div className="text-sm text-emerald-700">High-Yield Questions You Selected</div>
                  </div>
                  <div className="bg-orange-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-orange-900">{data.efficiency}%</div>
                    <div className="text-sm text-orange-700">Efficiency Score</div>
                    <div className="text-xs text-orange-600 mt-1">(High-yield selected / Total selected)</div>
                  </div>
                </div>

                {data.missedOptimal > 0 && (
                  <div className="bg-red-50 border-2 border-red-300 p-4 rounded-lg mb-4">
                    <h4 className="font-bold text-red-900 mb-2">⚠️ You Missed {data.missedOptimal} High-Yield Questions:</h4>
                    <ul className="space-y-2">
                      {data.missedOptimalQuestions.slice(0, 5).map((q) => (
                        <li key={q.id} className="text-sm text-red-800">
                          <span className="font-semibold">• {q.question}</span>
                          <p className="text-xs text-red-700 ml-4 mt-1">Why important: {q.rationale}</p>
                        </li>
                      ))}
                    </ul>
                    {data.missedOptimalQuestions.length > 5 && (
                      <p className="text-sm text-red-700 mt-2">...and {data.missedOptimalQuestions.length - 5} more</p>
                    )}
                  </div>
                )}

                {data.lowPrioritySelected > 0 && (
                  <div className="bg-yellow-50 border-2 border-yellow-300 p-4 rounded-lg">
                    <h4 className="font-bold text-yellow-900 mb-2">💡 You Selected {data.lowPrioritySelected} Lower-Priority Questions:</h4>
                    <p className="text-sm text-yellow-800 mb-2">These aren't "wrong" to ask, but in a time-limited OSCE, they're lower priority than the high-yield questions above.</p>
                    <ul className="space-y-2">
                      {data.lowPriorityQuestions.slice(0, 5).map((q) => (
                        <li key={q.id} className="text-sm text-yellow-800">
                          <span className="font-semibold">• {q.question}</span>
                          <p className="text-xs text-yellow-700 ml-4 mt-1">{q.rationale}</p>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                <div className="mt-4 p-4 bg-indigo-50 rounded-lg">
                  <h4 className="font-semibold text-indigo-900 mb-2">💡 Interpretation:</h4>
                  {data.efficiency >= 80 && (
                    <p className="text-indigo-800">Excellent! You focused on high-yield questions and avoided lower-priority items. This approach will serve you well in time-limited OSCEs.</p>
                  )}
                  {data.efficiency >= 60 && data.efficiency < 80 && (
                    <p className="text-indigo-800">Good job! You selected many high-yield questions. Consider being even more targeted by focusing on questions that directly distinguish between diagnoses.</p>
                  )}
                  {data.efficiency < 60 && (
                    <p className="text-indigo-800">You selected many questions, but some were lower priority. In time-limited encounters, focus first on questions that are EXCELLENT or GOOD quality - these distinguish between diagnoses most efficiently.</p>
                  )}
                </div>
              </div>
            );
          };

          const renderPhysicalComparisonView = () => {
            const data = getPhysicalComparisonData();
            
            return (
              <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 className="text-2xl font-bold text-gray-900 mb-4">📊 Physical Exam Performance Analysis</h3>
                
                <div className="grid grid-cols-2 gap-4 mb-6">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-blue-900">{data.totalSelected}</div>
                    <div className="text-sm text-blue-700">Maneuvers You Selected</div>
                  </div>
                  <div className="bg-green-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-green-900">{data.totalOptimal}</div>
                    <div className="text-sm text-green-700">Optimal High-Yield Maneuvers</div>
                  </div>
                  <div className="bg-emerald-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-emerald-900">{data.selectedOptimal}</div>
                    <div className="text-sm text-emerald-700">High-Yield Maneuvers You Selected</div>
                  </div>
                  <div className="bg-orange-50 p-4 rounded-lg">
                    <div className="text-3xl font-bold text-orange-900">{data.efficiency}%</div>
                    <div className="text-sm text-orange-700">Efficiency Score</div>
                  </div>
                </div>

                {data.missedOptimal > 0 && (
                  <div className="bg-red-50 border-2 border-red-300 p-4 rounded-lg mb-4">
                    <h4 className="font-bold text-red-900 mb-2">⚠️ You Missed {data.missedOptimal} High-Yield Exam Maneuvers:</h4>
                    <ul className="space-y-2">
                      {data.missedOptimalExams.slice(0, 5).map((e) => (
                        <li key={e.id} className="text-sm text-red-800">
                          <span className="font-semibold">• {e.maneuver}</span>
                          <p className="text-xs text-red-700 ml-4 mt-1">Why important: {e.rationale}</p>
                        </li>
                      ))}
                    </ul>
                    {data.missedOptimalExams.length > 5 && (
                      <p className="text-sm text-red-700 mt-2">...and {data.missedOptimalExams.length - 5} more</p>
                    )}
                  </div>
                )}

                {data.lowPrioritySelected > 0 && (
                  <div className="bg-yellow-50 border-2 border-yellow-300 p-4 rounded-lg">
                    <h4 className="font-bold text-yellow-900 mb-2">💡 You Selected {data.lowPrioritySelected} Lower-Priority Maneuvers:</h4>
                    <ul className="space-y-2">
                      {data.lowPriorityExams.slice(0, 5).map((e) => (
                        <li key={e.id} className="text-sm text-yellow-800">
                          <span className="font-semibold">• {e.maneuver}</span>
                          <p className="text-xs text-yellow-700 ml-4 mt-1">{e.rationale}</p>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            );
          };

          const renderInitialStage = () => (
            <div className="space-y-6">
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-6 rounded-lg">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Door Note</h3>
                <div className="grid grid-cols-2 gap-4 text-gray-800">
                  <div><span className="font-semibold">Patient:</span> {currentCase.doorNote.name}</div>
                  <div><span className="font-semibold">Age:</span> {currentCase.doorNote.age} years</div>
                  <div><span className="font-semibold">Sex:</span> {currentCase.doorNote.sex}</div>
                  <div><span className="font-semibold">Location:</span> {currentCase.doorNote.location}</div>
                  <div className="col-span-2"><span className="font-semibold">Chief Complaint:</span> "{currentCase.doorNote.chiefComplaint}"</div>
                  <div className="col-span-2"><span className="font-semibold">Vitals:</span> {currentCase.doorNote.vitals}</div>
                </div>
              </div>

              <div className="bg-indigo-100 border-2 border-indigo-500 p-6 rounded-lg">
                <h3 className="text-lg font-semibold text-indigo-900 mb-2">Your First Task</h3>
                <p className="text-indigo-800 mb-4">
                  Based ONLY on the door note information above, generate your initial differential diagnosis. What are the most likely causes of this patient's presentation? What must-not-miss diagnoses should you consider?
                </p>
                <p className="text-indigo-700 text-sm">
                  In the next step, you'll select your top 3-5 diagnoses and get feedback on your clinical reasoning.
                </p>
              </div>

              <button
                onClick={() => setCurrentStage('differential')}
                className="w-full bg-indigo-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-indigo-700 transition-colors"
              >
                Generate My Differential Diagnosis →
              </button>
            </div>
          );

          const renderDifferentialStage = () => (
            <div className="space-y-6">
              <div className="bg-orange-50 border-l-4 border-orange-500 p-6 rounded-lg">
                <h3 className="text-lg font-semibold text-orange-900 mb-2">Generate Your Differential</h3>
                <p className="text-orange-800">
                  Select your top 3-5 most likely diagnoses based on the patient's presentation. Include at least one "must-not-miss" diagnosis. Click on body systems to expand and see possible diagnoses.
                </p>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-6">
                <h3 className="text-xl font-bold text-gray-900 mb-4">Select Diagnoses by System</h3>
                <div className="space-y-2">
                  {Object.keys(differentialsBySystem).map((system) => (
                    <div key={system} className="border-2 border-gray-200 rounded-lg overflow-hidden">
                      <div
                        className="system-section p-4 bg-gray-50 flex justify-between items-center"
                        onClick={() => toggleSystemExpansion(system)}
                      >
                        <h4 className="font-semibold text-gray-900">{system}</h4>
                        <span className="text-gray-600">
                          {expandedSystems.includes(system) ? '▼' : '▶'}
                        </span>
                      </div>
                      {expandedSystems.includes(system) && (
                        <div className="p-4 space-y-2 bg-white">
                          {differentialsBySystem[system].map((dx) => {
                            const isSelected = selectedDifferentials.includes(dx);
                            return (
                              <div
                                key={dx}
                                className={`p-3 border-2 rounded cursor-pointer transition-all ${
                                  isSelected ? 'selected-choice' : 'border-gray-200 hover:border-gray-400'
                                }`}
                                onClick={() => toggleDifferentialSelection(dx)}
                              >
                                <div className="flex items-center justify-between">
                                  <span className="text-gray-900">{dx}</span>
                                  <input
                                    type="checkbox"
                                    checked={isSelected}
                                    onChange={() => {}}
                                    className="w-5 h-5"
                                  />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>

              {selectedDifferentials.length > 0 && (
                <div className="bg-blue-50 border-2 border-blue-500 p-4 rounded-lg">
                  <h4 className="font-semibold text-blue-900 mb-2">
                    Your Selected Differential ({selectedDifferentials.length} diagnoses):
                  </h4>
                  <div className="flex flex-wrap gap-2">
                    {selectedDifferentials.map((dx) => (
                      <span key={dx} className="bg-blue-200 text-blue-900 px-3 py-1 rounded-full text-sm">
                        {dx}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              <div className="flex gap-4">
                <button
                  onClick={() => setShowDifferentialFeedback(true)}
                  className="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                  disabled={showDifferentialFeedback || selectedDifferentials.length === 0}
                >
                  Get Feedback on My Differential
                </button>
                
                {showDifferentialFeedback && (
                  <button
                    onClick={() => setCurrentStage('history')}
                    className="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                  >
                    Move to History Taking →
                  </button>
                )}
              </div>

              {showDifferentialFeedback && (
                <div className="bg-white rounded-lg shadow-lg p-6 space-y-4">
                  <h3 className="text-xl font-bold text-gray-900">Expected Differential & Feedback</h3>
                  
                  <div className="space-y-3">
                    {currentCase.expectedDifferential.map((dx, idx) => {
                      const wasSelected = selectedDifferentials.some(selected => 
                        diagnosisMatches(selected, dx.diagnosis)
                      );
                      return (
                        <div key={idx} className={`p-4 rounded-lg ${wasSelected ? 'bg-green-50 border-2 border-green-500' : 'bg-gray-50 border-2 border-gray-300'}`}>
                          <div className="flex justify-between items-start mb-2">
                            <h4 className="font-bold text-gray-900">{dx.diagnosis}</h4>
                            <div className="flex items-center gap-2">
                              {wasSelected && <span className="text-green-600 font-semibold">✓ You included this</span>}
                              <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                dx.priority === 'MUST-NOT-MISS' ? 'bg-red-100 text-red-800' :
                                dx.priority === 'Most likely' ? 'bg-green-100 text-green-800' :
                                'bg-indigo-100 text-indigo-800'
                              }`}>
                                {dx.priority}
                              </span>
                            </div>
                          </div>
                          <p className="text-gray-700 text-sm">{dx.reasoning}</p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          );

          const toggleHistorySelection = (questionId) => {
            if (selectedHistory.includes(questionId)) {
              setSelectedHistory(selectedHistory.filter(id => id !== questionId));
            } else {
              setSelectedHistory([...selectedHistory, questionId]);
            }
          };

          const togglePhysicalSelection = (examId) => {
            if (selectedPhysical.includes(examId)) {
              setSelectedPhysical(selectedPhysical.filter(id => id !== examId));
            } else {
              setSelectedPhysical([...selectedPhysical, examId]);
            }
          };

          const renderHistoryStage = () => {
            const questionCategories = [
              { key: 'hpiFollowUp', label: 'HPI Follow-up Questions', description: 'Questions to clarify the chief complaint and associated symptoms' },
              { key: 'ros', label: 'Review of Systems', description: 'Systematic review - select only relevant questions for this case' },
              { key: 'pmh', label: 'Past Medical History', description: 'Previous diagnoses, surgeries, and hospitalizations' },
              { key: 'socialHistory', label: 'Social & Family History', description: 'Medications, substances, family history, social factors' }
            ];

            return (
              <div className="space-y-6">
                <div className="bg-teal-50 border-l-4 border-teal-500 p-6 rounded-lg">
                  <h3 className="text-lg font-semibold text-teal-900 mb-2">Hypothesis-Driven History Taking</h3>
                  <p className="text-teal-800">
                    Select the questions you would ask this patient. Remember: you have <span className="font-bold">limited time</span>. Choose questions that will help distinguish between your differential diagnoses.
                  </p>
                  <p className="text-teal-700 text-sm mt-2">
                    💡 Not all questions are equally valuable. After selecting, you'll see which questions are high-yield vs. low-priority for this case.
                  </p>
                </div>

                {questionCategories.map((category) => (
                  <div key={category.key} className="bg-white rounded-lg shadow-lg p-6">
                    <h3 className="text-xl font-bold text-gray-900 mb-2">{category.label}</h3>
                    <p className="text-gray-600 text-sm mb-4">{category.description}</p>
                    <div className="space-y-2">
                      {currentCase.historyQuestions[category.key].map((q) => {
                        const isSelected = selectedHistory.includes(q.id);
                        const showQuality = showFeedback;
                        return (
                          <div
                            key={q.id}
                            className={`p-3 border-2 rounded cursor-pointer transition-all ${
                              showQuality
                                ? q.quality === 'excellent' ? 'excellent-choice' :
                                  q.quality === 'good' ? 'good-choice' :
                                  q.quality === 'fair' ? 'fair-choice' :
                                  'low-priority-choice'
                                : isSelected ? 'selected-choice' : 'border-gray-200 hover:border-gray-400'
                            }`}
                            onClick={() => !showFeedback && toggleHistorySelection(q.id)}
                          >
                            <div className="flex items-center justify-between">
                              <span className="text-gray-900 flex-1">{q.question}</span>
                              <div className="flex items-center gap-2">
                                {showQuality && (
                                  <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                    q.quality === 'excellent' ? 'bg-green-200 text-green-800' :
                                    q.quality === 'good' ? 'bg-blue-200 text-blue-800' :
                                    q.quality === 'fair' ? 'bg-yellow-200 text-yellow-800' :
                                    'bg-red-200 text-red-800'
                                  }`}>
                                    {q.quality.toUpperCase()}
                                  </span>
                                )}
                                <input
                                  type="checkbox"
                                  checked={isSelected}
                                  onChange={() => {}}
                                  className="w-5 h-5"
                                  disabled={showFeedback}
                                />
                              </div>
                            </div>
                            {showQuality && (
                              <p className="text-sm text-gray-600 mt-2 italic">{q.rationale}</p>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}

                <div className="bg-blue-50 border-2 border-blue-500 p-4 rounded-lg">
                  <h4 className="font-semibold text-blue-900">
                    Questions Selected: {selectedHistory.length}
                  </h4>
                </div>

                <div className="flex gap-4">
                  <button
                    onClick={() => {
                      setShowFeedback(true);
                      setShowComparison(true);
                    }}
                    className="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                    disabled={showFeedback}
                  >
                    Get Feedback on My Choices
                  </button>
                  
                  {showFeedback && (
                    <button
                      onClick={() => setCurrentStage('physical')}
                      className="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                    >
                      Move to Physical Exam →
                    </button>
                  )}
                </div>

                {showComparison && renderComparisonView()}

                {showFeedback && (
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <h3 className="text-xl font-bold text-gray-900 mb-4">Question Quality Legend</h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="flex items-center gap-2">
                        <div className="w-4 h-4 rounded bg-green-500"></div>
                        <span><strong>EXCELLENT:</strong> Essential, high-yield question</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-4 h-4 rounded bg-blue-500"></div>
                        <span><strong>GOOD:</strong> Useful question, adds value</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-4 h-4 rounded bg-yellow-500"></div>
                        <span><strong>FAIR:</strong> Reasonable but lower priority</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-4 h-4 rounded bg-red-500"></div>
                        <span><strong>LOW-PRIORITY:</strong> Not relevant to this case</span>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          };

          const renderPhysicalStage = () => {
            const [showPhysicalFeedback, setShowPhysicalFeedback] = useState(false);
            const [showPhysicalComparison, setShowPhysicalComparison] = useState(false);

            return (
              <div className="space-y-6">
                <div className="bg-purple-50 border-l-4 border-purple-500 p-6 rounded-lg">
                  <h3 className="text-lg font-semibold text-purple-900 mb-2">Targeted Physical Examination</h3>
                  <p className="text-purple-800">
                    Select the physical exam maneuvers you would perform. Remember: a hypothesis-driven exam focuses on maneuvers that will distinguish between your differential diagnoses.
                  </p>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-900 mb-4">Physical Exam Maneuvers</h3>
                  <div className="space-y-2">
                    {currentCase.physicalExam.map((exam) => {
                      const isSelected = selectedPhysical.includes(exam.id);
                      const showQuality = showPhysicalFeedback;
                      return (
                        <div
                          key={exam.id}
                          className={`p-3 border-2 rounded cursor-pointer transition-all ${
                            showQuality
                              ? exam.quality === 'excellent' ? 'excellent-choice' :
                                exam.quality === 'good' ? 'good-choice' :
                                exam.quality === 'fair' ? 'fair-choice' :
                                'low-priority-choice'
                              : isSelected ? 'selected-choice' : 'border-gray-200 hover:border-gray-400'
                          }`}
                          onClick={() => !showPhysicalFeedback && togglePhysicalSelection(exam.id)}
                        >
                          <div className="flex items-center justify-between">
                            <span className="text-gray-900 flex-1 font-medium">{exam.maneuver}</span>
                            <div className="flex items-center gap-2">
                              {showQuality && (
                                <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                  exam.quality === 'excellent' ? 'bg-green-200 text-green-800' :
                                  exam.quality === 'good' ? 'bg-blue-200 text-blue-800' :
                                  exam.quality === 'fair' ? 'bg-yellow-200 text-yellow-800' :
                                  'bg-red-200 text-red-800'
                                }`}>
                                  {exam.quality.toUpperCase()}
                                </span>
                              )}
                              <input
                                type="checkbox"
                                checked={isSelected}
                                onChange={() => {}}
                                className="w-5 h-5"
                                disabled={showPhysicalFeedback}
                              />
                            </div>
                          </div>
                          {showQuality && (
                            <div className="mt-2 space-y-1">
                              <p className="text-sm text-gray-600 italic">{exam.rationale}</p>
                              <p className="text-sm text-gray-800"><strong>Finding:</strong> {exam.finding}</p>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>

                <div className="bg-purple-50 border-2 border-purple-500 p-4 rounded-lg">
                  <h4 className="font-semibold text-purple-900">
                    Exam Maneuvers Selected: {selectedPhysical.length}
                  </h4>
                </div>

                <div className="flex gap-4">
                  <button
                    onClick={() => {
                      setShowPhysicalFeedback(true);
                      setShowPhysicalComparison(true);
                    }}
                    className="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                    disabled={showPhysicalFeedback}
                  >
                    Get Feedback on My Exam
                  </button>
                  
                  {showPhysicalFeedback && (
                    <button
                      onClick={() => setCurrentStage('diagnosis')}
                      className="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                    >
                      Move to Diagnosis →
                    </button>
                  )}
                </div>

                {showPhysicalComparison && renderPhysicalComparisonView()}
              </div>
            );
          };

          const renderDiagnosisStage = () => (
            <div className="space-y-6">
              <div className="bg-emerald-50 border-l-4 border-emerald-500 p-6 rounded-lg">
                <h3 className="text-lg font-semibold text-emerald-900 mb-2">Final Diagnosis & Case Resolution</h3>
                <p className="text-emerald-800">
                  Based on your history and physical exam findings, review the actual diagnosis and learn the key teaching points from this case.
                </p>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-6">
                <h3 className="text-2xl font-bold text-emerald-900 mb-4">
                  Actual Diagnosis: {currentCase.actualDiagnosis.diagnosis}
                </h3>
                
                <div className="space-y-4">
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-2">Key Findings Supporting Diagnosis:</h4>
                    <ul className="list-disc list-inside space-y-1 text-gray-700">
                      {currentCase.actualDiagnosis.keyFindings.map((finding, idx) => (
                        <li key={idx}>{finding}</li>
                      ))}
                    </ul>
                  </div>
                  
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-2">Clinical Reasoning:</h4>
                    <p className="text-gray-700">{currentCase.actualDiagnosis.reasoning}</p>
                  </div>
                  
                  <div>
                    <h4 className="font-semibold text-gray-900 mb-2">Next Steps:</h4>
                    <p className="text-gray-700">{currentCase.actualDiagnosis.nextSteps}</p>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-6">
                <h3 className="text-xl font-bold text-gray-900 mb-4">Diagnostic Studies</h3>
                <div className="space-y-4">
                  {currentCase.diagnosticStudies.map((study, idx) => (
                    <div key={idx} className={`p-4 rounded-lg ${
                      study.priority.includes('MUST') || study.priority.includes('FIRST') ? 'bg-red-50 border-2 border-red-300' :
                      study.priority.includes('Essential') ? 'bg-orange-50 border-2 border-orange-300' :
                      'bg-gray-50 border-2 border-gray-200'
                    }`}>
                      <div className="flex justify-between items-start mb-2">
                        <h4 className="font-bold text-gray-900">{study.study}</h4>
                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                          study.priority.includes('MUST') || study.priority.includes('FIRST') ? 'bg-red-200 text-red-800' :
                          study.priority.includes('Essential') ? 'bg-orange-200 text-orange-800' :
                          'bg-gray-200 text-gray-800'
                        }`}>
                          {study.priority}
                        </span>
                      </div>
                      <p className="text-sm text-gray-600 mb-2">{study.rationale}</p>
                      <p className="text-sm"><strong>Expected Result:</strong> {study.expectedResult}</p>
                      <p className="text-sm"><strong>Interpretation:</strong> {study.interpretation}</p>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg shadow-lg p-6">
                <h3 className="text-xl font-bold text-indigo-900 mb-4">📚 Key Teaching Points</h3>
                <ul className="space-y-2">
                  {currentCase.teachingPoints.map((point, idx) => (
                    <li key={idx} className="flex items-start gap-2 text-indigo-800">
                      <span className="text-indigo-500 font-bold">•</span>
                      {point}
                    </li>
                  ))}
                </ul>
              </div>

              <button
                onClick={() => {
                  setCurrentStage('initial');
                  setSelectedDifferentials([]);
                  setShowDifferentialFeedback(false);
                  setSelectedHistory([]);
                  setSelectedPhysical([]);
                  setShowFeedback(false);
                  setShowComparison(false);
                  setExpandedSystems([]);
                }}
                className="w-full bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
              >
                Start Over
              </button>
            </div>
          );

          return (
            <div className="min-h-screen bg-gray-100">
              <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-6 px-4 shadow-lg">
                <div className="max-w-4xl mx-auto">
                  <h1 className="text-3xl font-bold">Clinical Reasoning Tool</h1>
                  <p className="text-indigo-200 mt-1">Learn hypothesis-driven history taking and targeted physical examination</p>
                </div>
              </div>

              <div className="max-w-4xl mx-auto py-6 px-4">
                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                  <div className="flex justify-between items-center mb-2">
                    <h2 className="text-xl font-bold text-gray-900">
                      Case: {currentCase.title}
                    </h2>
                    <a href="index.html" className="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                      ← Back to All Cases
                    </a>
                  </div>
                  <div className="flex gap-2 flex-wrap">
                    {['initial', 'differential', 'history', 'physical', 'diagnosis'].map((stage, idx) => (
                      <div
                        key={stage}
                        className={`px-3 py-1 rounded-full text-sm font-medium ${
                          currentStage === stage
                            ? 'bg-indigo-600 text-white'
                            : 'bg-gray-200 text-gray-600'
                        }`}
                      >
                        {idx + 1}. {stage.charAt(0).toUpperCase() + stage.slice(1)}
                      </div>
                    ))}
                  </div>
                </div>

                {currentStage === 'initial' && renderInitialStage()}
                {currentStage === 'differential' && renderDifferentialStage()}
                {currentStage === 'history' && renderHistoryStage()}
                {currentStage === 'physical' && renderPhysicalStage()}
                {currentStage === 'diagnosis' && renderDiagnosisStage()}
              </div>
            </div>
          );
        };

        ReactDOM.render(<ClinicalReasoningTool />, document.getElementById('root'));
    </script>
</body>
</html>
